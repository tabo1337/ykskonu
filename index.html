<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YKS √áalƒ±≈üma Takip üíú</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #9b7ed9;
            --primary-light: #c4b5fd;
            --secondary: #f0abfc;
            --accent: #67e8f9;
            --bg-gradient: linear-gradient(135deg, #fdf4ff 0%, #f5f3ff 50%, #ecfeff 100%);
            --card-bg: #ffffff;
            --text: #4c1d95;
            --text-light: #7c3aed;
            --success: #a7f3d0;
            --success-dark: #10b981;
            --danger: #fecaca;
            --danger-dark: #ef4444;
            --warning: #fef3c7;
            --warning-dark: #f59e0b;
        }

        /* Theme: Pink */
        [data-theme="pink"] {
            --primary: #ec4899;
            --primary-light: #f9a8d4;
            --secondary: #f472b6;
            --accent: #fda4af;
            --bg-gradient: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 50%, #fff1f2 100%);
            --text: #831843;
            --text-light: #be185d;
        }

        /* Theme: Blue */
        [data-theme="blue"] {
            --primary: #3b82f6;
            --primary-light: #93c5fd;
            --secondary: #60a5fa;
            --accent: #7dd3fc;
            --bg-gradient: linear-gradient(135deg, #eff6ff 0%, #dbeafe 50%, #e0f2fe 100%);
            --text: #1e3a8a;
            --text-light: #2563eb;
        }

        /* Theme: Green */
        [data-theme="green"] {
            --primary: #10b981;
            --primary-light: #6ee7b7;
            --secondary: #34d399;
            --accent: #5eead4;
            --bg-gradient: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 50%, #ccfbf1 100%);
            --text: #064e3b;
            --text-light: #059669;
        }

        /* Theme: Orange */
        [data-theme="orange"] {
            --primary: #f97316;
            --primary-light: #fdba74;
            --secondary: #fb923c;
            --accent: #fcd34d;
            --bg-gradient: linear-gradient(135deg, #fff7ed 0%, #ffedd5 50%, #fef3c7 100%);
            --text: #7c2d12;
            --text-light: #ea580c;
        }

        /* Theme: Red */
        [data-theme="red"] {
            --primary: #ef4444;
            --primary-light: #fca5a5;
            --secondary: #f87171;
            --accent: #fda4af;
            --bg-gradient: linear-gradient(135deg, #fef2f2 0%, #fee2e2 50%, #fecaca 100%);
            --text: #7f1d1d;
            --text-light: #dc2626;
        }

        /* Theme: Teal */
        [data-theme="teal"] {
            --primary: #14b8a6;
            --primary-light: #5eead4;
            --secondary: #2dd4bf;
            --accent: #67e8f9;
            --bg-gradient: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 50%, #cffafe 100%);
            --text: #134e4a;
            --text-light: #0d9488;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text);
        }

        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 50px 40px;
            box-shadow: 0 4px 20px rgba(155, 126, 217, 0.15);
            text-align: center;
            max-width: 400px;
            width: 100%;
            border: 1px solid #f3e8ff;
        }

        .login-card h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-card .subtitle {
            color: var(--text-light);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .login-card .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .login-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--primary-light);
            border-radius: 15px;
            font-size: 1.1rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
            text-align: center;
        }

        .login-input:focus {
            border-color: var(--primary);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
        }

        .login-btn:hover { opacity: 0.95; }
        .login-btn:active { transform: scale(0.98); }

        /* Main App */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(155, 126, 217, 0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-name {
            font-weight: 700;
            color: var(--text-light);
        }

        .logout-btn {
            padding: 8px 20px;
            background: transparent;
            border: 2px solid var(--primary-light);
            border-radius: 20px;
            color: var(--primary);
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: background-color 0.2s, color 0.2s;
        }

        .logout-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Theme Picker */
        .theme-picker {
            position: relative;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-light);
            background: var(--card-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: border-color 0.2s;
        }

        .theme-btn:hover {
            border-color: var(--primary);
        }

        .theme-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1000;
            min-width: 200px;
        }

        .theme-dropdown.open {
            display: block;
        }

        .theme-dropdown h4 {
            margin-bottom: 12px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .theme-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .theme-color {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
        }

        .theme-color:hover {
            transform: scale(1.1);
        }

        .theme-color.active {
            border-color: var(--text);
        }

        .theme-color[data-theme="purple"] { background: linear-gradient(135deg, #9b7ed9, #f0abfc); }
        .theme-color[data-theme="pink"] { background: linear-gradient(135deg, #ec4899, #f472b6); }
        .theme-color[data-theme="blue"] { background: linear-gradient(135deg, #3b82f6, #60a5fa); }
        .theme-color[data-theme="green"] { background: linear-gradient(135deg, #10b981, #34d399); }
        .theme-color[data-theme="orange"] { background: linear-gradient(135deg, #f97316, #fb923c); }
        .theme-color[data-theme="red"] { background: linear-gradient(135deg, #ef4444, #f87171); }
        .theme-color[data-theme="teal"] { background: linear-gradient(135deg, #14b8a6, #2dd4bf); }

        .custom-color-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }

        .custom-color-section label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .custom-color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .custom-color-picker input[type="color"] {
            width: 50px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
            background: none;
        }

        .custom-color-picker input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 2px;
        }

        .custom-color-picker input[type="color"]::-webkit-color-swatch {
            border-radius: 6px;
            border: none;
        }

        .apply-custom-btn {
            padding: 8px 15px;
            background: var(--primary);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .apply-custom-btn:hover {
            opacity: 0.9;
        }

        /* Stats Overview */
        .stats-overview {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(155, 126, 217, 0.08);
            border: 1px solid #f3e8ff;
        }

        .stat-card h3 {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-percentage {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .progress-bar {
            height: 12px;
            background: #f3e8ff;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.3s;
        }

        .stat-detail {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Tabs */
        .tabs-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 30px;
            border: none;
            background: var(--card-bg);
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-light);
            transition: background-color 0.2s, color 0.2s;
            box-shadow: 0 2px 8px rgba(155, 126, 217, 0.08);
        }

        .tab-btn:hover { background: #f3e8ff; }
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        /* Content */
        .content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 50px;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Subject Cards */
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .subject-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(155, 126, 217, 0.08);
            border: 1px solid #f3e8ff;
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .subject-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subject-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .subject-title h3 { font-size: 1.3rem; }

        .subject-progress { text-align: right; }
        .subject-progress .percentage {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }
        .subject-progress .count {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .topics-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .topics-list.open {
            max-height: 5000px;
            transition: max-height 0.5s ease-in;
        }

        .topic-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            margin: 8px 0;
            background: #faf5ff;
            border-radius: 12px;
            cursor: pointer;
        }

        .topic-item:hover { background: #f3e8ff; }
        .topic-item:active { background: #ede9fe; }
        .topic-item.completed { background: var(--success); }
        .topic-item.completed .topic-text {
            text-decoration: line-through;
            color: var(--success-dark);
        }

        .topic-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--primary-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .topic-item.completed .topic-checkbox {
            background: var(--success-dark);
            border-color: var(--success-dark);
            color: white;
        }

        .topic-text { flex: 1; font-weight: 600; }

        .topic-wrong-count {
            background: var(--danger);
            color: var(--danger-dark);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .toggle-icon {
            font-size: 1.2rem;
            color: var(--primary-light);
            transition: transform 0.2s;
        }

        .subject-header.open .toggle-icon { transform: rotate(180deg); }

        /* Subtopics */
        .subtopics-container {
            margin-left: 36px;
            padding-left: 15px;
            border-left: 2px solid #e9d5ff;
            display: none;
        }
        .subtopics-container.open { display: block; }

        .subtopic-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin: 4px 0;
            background: #fdf4ff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .subtopic-item:hover { background: #fae8ff; }
        .subtopic-item.completed { background: #d1fae5; }
        .subtopic-item.completed .subtopic-text {
            text-decoration: line-through;
            color: var(--success-dark);
        }

        .subtopic-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--primary-light);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.7rem;
        }
        .subtopic-item.completed .subtopic-checkbox {
            background: var(--success-dark);
            border-color: var(--success-dark);
            color: white;
        }

        .subtopic-text { flex: 1; }

        .topic-expand-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: var(--primary-light);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .topic-expand-btn:hover { background: var(--primary); }

        /* Colors for subjects */
        .bg-turkish { background: linear-gradient(135deg, #f472b6, #ec4899); }
        .bg-math { background: linear-gradient(135deg, #a78bfa, #8b5cf6); }
        .bg-science { background: linear-gradient(135deg, #67e8f9, #06b6d4); }
        .bg-social { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .bg-physics { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
        .bg-chemistry { background: linear-gradient(135deg, #34d399, #10b981); }
        .bg-biology { background: linear-gradient(135deg, #fb7185, #f43f5e); }
        .bg-geometry { background: linear-gradient(135deg, #c084fc, #a855f7); }

        /* Charts Section */
        .charts-section {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(155, 126, 217, 0.08);
            border: 1px solid #f3e8ff;
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bar-label {
            width: 80px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .bar-container {
            flex: 1;
            height: 25px;
            background: #f3e8ff;
            border-radius: 12px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            min-width: 40px;
        }

        /* Motivational Quote */
        .motivation-banner {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .motivation-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            padding: 30px 40px;
            color: white;
            text-align: center;
        }

        .motivation-card .quote { font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }
        .motivation-card .author { font-size: 1rem; opacity: 0.9; }

        /* Deneme Analizi Styles */
        .deneme-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .deneme-form-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(155, 126, 217, 0.08);
            border: 1px solid #f3e8ff;
        }

        .deneme-form-card h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text);
        }

        .deneme-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .deneme-tab-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--primary-light);
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            color: var(--primary);
            transition: background-color 0.2s, color 0.2s;
        }

        .deneme-tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .deneme-form { display: none; }
        .deneme-form.active { display: block; }

        /* Bran≈ü Denemesi */
        .brans-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .brans-btn {
            padding: 15px 10px;
            border: 2px solid var(--primary-light);
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            color: var(--primary);
            transition: background-color 0.2s, color 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .brans-btn i { font-size: 1.3rem; }

        .brans-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .brans-btn:hover:not(.active) {
            background: #f3e8ff;
        }

        @media (max-width: 600px) {
            .brans-selector {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 12px;
            background: #faf5ff;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .form-row label { font-weight: 700; color: var(--text); }

        .form-row input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--primary-light);
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.9rem;
            text-align: center;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-row input:focus { border-color: var(--primary); }

        .wrong-topics-btn {
            padding: 8px 12px;
            background: var(--danger);
            border: none;
            border-radius: 10px;
            color: var(--danger-dark);
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .wrong-topics-btn:hover { background: #fca5a5; }
        .wrong-topics-btn.has-selection {
            background: var(--danger-dark);
            color: white;
        }

        .deneme-date { margin-bottom: 15px; }
        .deneme-date label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-light);
        }

        .deneme-date input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--primary-light);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            outline: none;
        }

        .save-deneme-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 15px;
        }

        .save-deneme-btn:hover { opacity: 0.95; }
        .save-deneme-btn:active { transform: scale(0.98); }

        .cancel-edit-btn {
            width: 100%;
            padding: 12px;
            background: #f3e8ff;
            border: none;
            border-radius: 12px;
            color: var(--primary);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 10px;
            display: none;
        }

        /* Net Display */
        .net-display {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-align: center;
            margin-top: 15px;
        }

        .net-display .net-value { font-size: 2.5rem; font-weight: 800; }
        .net-display .net-label { font-size: 0.9rem; opacity: 0.9; }

        /* Eksik Konular Section */
        .eksik-konular-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(155, 126, 217, 0.08);
            border: 1px solid #f3e8ff;
        }

        .eksik-konular-card h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text);
        }

        .eksik-list { max-height: 400px; overflow-y: auto; }

        .eksik-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: var(--danger);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .eksik-item .topic-info { flex: 1; }
        .eksik-item .topic-name { font-weight: 700; color: var(--text); }
        .eksik-item .subject-name { font-size: 0.85rem; color: var(--text-light); }

        .eksik-item .wrong-badge {
            background: var(--danger-dark);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .eksik-item .eksik-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tekrar-btn {
            padding: 6px 12px;
            background: var(--success);
            border: none;
            border-radius: 10px;
            color: var(--success-dark);
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tekrar-btn:hover {
            background: var(--success-dark);
            color: white;
        }

        .no-eksik {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .no-eksik i {
            font-size: 3rem;
            color: var(--success-dark);
            margin-bottom: 15px;
        }

        /* Deneme History */
        .deneme-history { margin-top: 30px; }
        .deneme-history h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .history-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(155, 126, 217, 0.08);
            border: 1px solid #f3e8ff;
            position: relative;
        }

        .history-card .date {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .history-card .type-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .history-card .type-badge.tyt {
            background: linear-gradient(135deg, #f472b6, #ec4899);
            color: white;
        }

        .history-card .type-badge.ayt {
            background: linear-gradient(135deg, #a78bfa, #8b5cf6);
            color: white;
        }

        .history-card .net-info {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin: 10px 0;
        }

        .history-subjects {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .history-subject {
            background: #f3e8ff;
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .history-subject .d { color: var(--success-dark); }
        .history-subject .y { color: var(--danger-dark); }

        .history-actions {
            display: flex;
            gap: 8px;
            position: absolute;
            bottom: 15px;
            right: 15px;
        }

        .edit-history-btn, .delete-history-btn {
            padding: 5px 10px;
            background: transparent;
            border: 1px solid;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .edit-history-btn {
            border-color: var(--primary);
            color: var(--primary);
        }
        .edit-history-btn:hover {
            background: var(--primary);
            color: white;
        }

        .delete-history-btn {
            border-color: var(--danger-dark);
            color: var(--danger-dark);
        }
        .delete-history-btn:hover {
            background: var(--danger-dark);
            color: white;
        }

        /* Love Modal */
        .love-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 182, 193, 0.3);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .love-modal-overlay.active { display: flex; }

        .love-modal {
            background: linear-gradient(135deg, #fff0f3 0%, #ffe4ec 100%);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(255, 105, 135, 0.3);
            border: 2px solid #ffb6c1;
            animation: lovePopIn 0.5s ease;
        }

        @keyframes lovePopIn {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .love-modal .heart-icon {
            font-size: 5rem;
            color: #ff6b8a;
            animation: heartBeat 1s infinite;
            display: block;
            margin-bottom: 20px;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .love-modal h2 {
            color: #d63384;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .love-modal p {
            color: #ff6b8a;
            font-size: 1.2rem;
            margin-bottom: 25px;
        }

        .love-modal-btn {
            padding: 12px 40px;
            background: linear-gradient(135deg, #ff6b8a, #ff8fab);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            transition: transform 0.2s;
        }

        .love-modal-btn:hover {
            transform: scale(1.05);
        }

        .floating-hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .floating-heart {
            position: absolute;
            font-size: 1.5rem;
            animation: floatUp 3s ease-in infinite;
            opacity: 0;
        }

        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-topics { max-height: 400px; overflow-y: auto; }

        .modal-topic-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: #faf5ff;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .modal-topic-item:hover { background: #f3e8ff; }
        .modal-topic-item.selected { background: var(--danger); }

        .modal-topic-item .checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--primary-light);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-topic-item.selected .checkbox {
            background: var(--danger-dark);
            border-color: var(--danger-dark);
            color: white;
        }

        .modal-topic-name { flex: 1; font-weight: 600; }

        /* Subtopic selection in modal */
        .modal-subtopics {
            margin-left: 34px;
            padding-left: 10px;
            border-left: 2px solid #e9d5ff;
            display: none;
        }
        .modal-subtopics.open { display: block; }

        .modal-subtopic-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: #fdf4ff;
            border-radius: 8px;
            margin: 4px 0;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .modal-subtopic-item:hover { background: #fae8ff; }
        .modal-subtopic-item.selected { background: #fed7d7; }

        .modal-subtopic-item .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--primary-light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        .modal-subtopic-item.selected .checkbox {
            background: var(--danger-dark);
            border-color: var(--danger-dark);
            color: white;
        }

        .modal-expand-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: var(--primary-light);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.7rem;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
        }

        .modal-btn:active { transform: scale(0.98); }
        .modal-btn.cancel { background: #f3e8ff; color: var(--primary); }
        .modal-btn.save {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .subjects-grid, .deneme-container { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; text-align: center; }
            .stat-percentage { font-size: 2.5rem; }
            .login-card { padding: 40px 25px; }
            .login-card h1 { font-size: 2rem; }
            .form-row { grid-template-columns: 1fr; gap: 8px; }
            .form-row label { text-align: center; }
            .tabs { justify-content: center; }
            .tab-btn { padding: 10px 20px; font-size: 0.9rem; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f3e8ff; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: var(--primary-light); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="icon">üìö‚ú®</div>
            <h1>YKS √áalƒ±≈üma Takip</h1>
            <p class="subtitle">Hedefine bir adƒ±m daha yakla≈ü! üí™</p>
            <input type="text" class="login-input" id="usernameInput" placeholder="Adƒ±nƒ± yaz..." maxlength="20">
            <button class="login-btn" onclick="login()">
                <i class="fas fa-heart"></i> Ba≈üla
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span style="font-size: 1.8rem;">üìö</span>
                    <h1>YKS Takip</h1>
                </div>
                <div class="user-info">
                    <span class="user-name">Merhaba, <span id="displayName"></span>!</span>
                    <div class="theme-picker">
                        <button class="theme-btn" onclick="toggleThemeDropdown()" title="Renk Se√ß">
                            <i class="fas fa-palette"></i>
                        </button>
                        <div class="theme-dropdown" id="themeDropdown">
                            <h4>Hazƒ±r Temalar</h4>
                            <div class="theme-colors">
                                <div class="theme-color active" data-theme="purple" onclick="setTheme('purple')" title="Mor"></div>
                                <div class="theme-color" data-theme="pink" onclick="setTheme('pink')" title="Pembe"></div>
                                <div class="theme-color" data-theme="blue" onclick="setTheme('blue')" title="Mavi"></div>
                                <div class="theme-color" data-theme="green" onclick="setTheme('green')" title="Ye≈üil"></div>
                                <div class="theme-color" data-theme="orange" onclick="setTheme('orange')" title="Turuncu"></div>
                                <div class="theme-color" data-theme="red" onclick="setTheme('red')" title="Kƒ±rmƒ±zƒ±"></div>
                                <div class="theme-color" data-theme="teal" onclick="setTheme('teal')" title="Turkuaz"></div>
                            </div>
                            <div class="custom-color-section">
                                <label>√ñzel Renk Se√ß</label>
                                <div class="custom-color-picker">
                                    <input type="color" id="customColorPicker" value="#9b7ed9">
                                    <button class="apply-custom-btn" onclick="applyCustomColor()">Uygula</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> √áƒ±kƒ±≈ü
                    </button>
                </div>
            </div>
        </header>

        <div class="motivation-banner">
            <div class="motivation-card">
                <p class="quote" id="motivationQuote">"Ba≈üarƒ±, her g√ºn tekrarlanan k√º√ß√ºk √ßabalarƒ±n toplamƒ±dƒ±r."</p>
                <p class="author">- Robert Collier</p>
            </div>
        </div>

        <div class="stats-overview">
            <div class="stat-card">
                <h3><i class="fas fa-book-open" style="color: #ec4899;"></i> TYT Genel ƒ∞lerleme</h3>
                <div class="stat-percentage" id="tytOverall">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="tytProgressBar" style="width: 0%"></div>
                </div>
                <p class="stat-detail" id="tytDetail">0 / 0 konu tamamlandƒ±</p>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-calculator" style="color: #8b5cf6;"></i> AYT Sayƒ±sal ƒ∞lerleme</h3>
                <div class="stat-percentage" id="aytOverall">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="aytProgressBar" style="width: 0%"></div>
                </div>
                <p class="stat-detail" id="aytDetail">0 / 0 konu tamamlandƒ±</p>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-trophy" style="color: #f59e0b;"></i> Toplam ƒ∞lerleme</h3>
                <div class="stat-percentage" id="totalOverall">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="totalProgressBar" style="width: 0%"></div>
                </div>
                <p class="stat-detail" id="totalDetail">0 / 0 konu tamamlandƒ±</p>
            </div>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('tyt')">üìù TYT</button>
                <button class="tab-btn" onclick="switchTab('ayt')">üî¨ AYT Sayƒ±sal</button>
                <button class="tab-btn" onclick="switchTab('deneme')">üìã Deneme Analizi</button>
                <button class="tab-btn" onclick="switchTab('charts')">üìä Grafikler</button>
            </div>
        </div>

        <div class="content">
            <div class="tab-content active" id="tytTab">
                <div class="subjects-grid" id="tytSubjects"></div>
            </div>

            <div class="tab-content" id="aytTab">
                <div class="subjects-grid" id="aytSubjects"></div>
            </div>

            <div class="tab-content" id="denemeTab">
                <div class="deneme-container">
                    <div class="deneme-form-card">
                        <h3 id="denemeFormTitle"><i class="fas fa-plus-circle" style="color: var(--primary);"></i> Yeni Deneme Ekle</h3>
                        
                        <div class="deneme-tabs">
                            <button class="deneme-tab-btn active" onclick="switchDenemeTab('tyt')">TYT</button>
                            <button class="deneme-tab-btn" onclick="switchDenemeTab('ayt')">AYT Sayƒ±sal</button>
                            <button class="deneme-tab-btn" onclick="switchDenemeTab('brans')">Bran≈ü</button>
                        </div>

                        <div class="deneme-date">
                            <label>Deneme Tarihi</label>
                            <input type="date" id="denemeDate">
                        </div>

                        <div class="deneme-form active" id="tytDenemeForm"></div>
                        <div class="deneme-form" id="aytDenemeForm"></div>
                        
                        <!-- Bran≈ü Denemesi Formu -->
                        <div class="deneme-form" id="bransDenemeForm">
                            <div class="brans-selector">
                                <button class="brans-btn active" onclick="selectBransCategory('matematik')" data-brans="matematik">
                                    <i class="fas fa-calculator"></i>
                                    <span>Matematik</span>
                                </button>
                                <button class="brans-btn" onclick="selectBransCategory('geometri')" data-brans="geometri">
                                    <i class="fas fa-shapes"></i>
                                    <span>Geometri</span>
                                </button>
                                <button class="brans-btn" onclick="selectBransCategory('turkce')" data-brans="turkce">
                                    <i class="fas fa-pen-fancy"></i>
                                    <span>T√ºrk√ße</span>
                                </button>
                                <button class="brans-btn" onclick="selectBransCategory('fen')" data-brans="fen">
                                    <i class="fas fa-flask"></i>
                                    <span>Fen</span>
                                </button>
                                <button class="brans-btn" onclick="selectBransCategory('sosyal')" data-brans="sosyal">
                                    <i class="fas fa-landmark"></i>
                                    <span>Sosyal</span>
                                </button>
                            </div>
                            
                            <div id="bransFormContent"></div>
                            
                            <div class="net-display" id="bransNetDisplay">
                                <div class="net-value" id="bransCurrentNet">0.00</div>
                                <div class="net-label">Toplam Net</div>
                            </div>
                        </div>

                        <div class="net-display">
                            <div class="net-label">Toplam Net</div>
                            <div class="net-value" id="currentNet">0.00</div>
                        </div>

                        <button class="save-deneme-btn" id="saveDenemeBtn" onclick="saveDeneme()">
                            <i class="fas fa-save"></i> Denemeyi Kaydet
                        </button>
                        <button class="cancel-edit-btn" id="cancelEditBtn" onclick="cancelEdit()">
                            <i class="fas fa-times"></i> ƒ∞ptal
                        </button>
                    </div>

                    <div class="eksik-konular-card">
                        <h3><i class="fas fa-exclamation-triangle" style="color: var(--danger-dark);"></i> En √áok Yanlƒ±≈ü Yapƒ±lan Konular</h3>
                        <div class="eksik-list" id="eksikList"></div>
                    </div>
                </div>

                <div class="deneme-history">
                    <h3><i class="fas fa-history" style="color: var(--primary);"></i> Deneme Ge√ßmi≈üi</h3>
                    <div class="history-grid" id="denemeHistory"></div>
                </div>
            </div>

            <div class="tab-content" id="chartsTab">
                <div class="charts-section">
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-bar" style="color: var(--primary);"></i> TYT Ders Bazlƒ± ƒ∞lerleme</h3>
                        <div class="bar-chart" id="tytChart"></div>
                    </div>
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-bar" style="color: var(--secondary);"></i> AYT Ders Bazlƒ± ƒ∞lerleme</h3>
                        <div class="bar-chart" id="aytChart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Love Modal -->
    <div class="love-modal-overlay" id="loveModalOverlay">
        <div class="floating-hearts" id="floatingHearts"></div>
        <div class="love-modal">
            <span class="heart-icon">üíï</span>
            <h2>Ho≈ü geldin canƒ±m!</h2>
            <p>Seni seviyorum bi tanem üíñ</p>
            <button class="love-modal-btn" onclick="closeLoveModal()">üíù Te≈üekk√ºrler</button>
        </div>
    </div>

    <!-- Modal for Wrong Topics -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h3><i class="fas fa-times-circle" style="color: var(--danger-dark);"></i> Yanlƒ±≈ü Yapƒ±lan Konular</h3>
            <p style="color: var(--text-light); margin-bottom: 15px; font-size: 0.9rem;">Yanlƒ±≈ü yaptƒ±ƒüƒ±n konu ve alt konularƒ± se√ß:</p>
            <div class="modal-topics" id="modalTopics"></div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeModal()">ƒ∞ptal</button>
                <button class="modal-btn save" onclick="saveWrongTopics()">Kaydet</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyALAi8VofS9eyaTZG3liL35u310l-2h_pQ",
            authDomain: "yks-takip-cd47c.firebaseapp.com",
            projectId: "yks-takip-cd47c",
            storageBucket: "yks-takip-cd47c.firebasestorage.app",
            messagingSenderId: "766439207363",
            appId: "1:766439207363:web:0b9012282ccc57e444cd76"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // TYT Konularƒ± ve Alt Ba≈ülƒ±klarƒ±
        const tytSubjects = {
            turkce: {
                name: "T√ºrk√ße",
                icon: "fas fa-pen-fancy",
                colorClass: "bg-turkish",
                questionCount: 40,
                topics: [
                    { name: "S√∂zc√ºkte Anlam" },
                    { name: "S√∂z Yorumu" },
                    { name: "Deyim ve Atas√∂zleri" },
                    { name: "C√ºmlede Anlam" },
                    { name: "Paragrafta Anlam" },
                    { name: "Paragrafta Yapƒ±" },
                    { name: "Anlatƒ±m Bozukluklarƒ±" },
                    { name: "Ses Bilgisi" },
                    { name: "Yazƒ±m Kurallarƒ±" },
                    { name: "Noktalama ƒ∞≈üaretleri" },
                    { name: "S√∂zc√ºkte Yapƒ±" },
                    { name: "ƒ∞sim (Ad)" },
                    { name: "Sƒ±fat" },
                    { name: "Zamir (Adƒ±l)" },
                    { name: "Zarf (Belirte√ß)" },
                    { name: "Edat - Baƒüla√ß - √únlem" },
                    { name: "Fiil (Eylem)" },
                    { name: "Fiilimsi (Eylemsi)" },
                    { name: "Ek Fiil" },
                    { name: "C√ºmlenin √ñgeleri" },
                    { name: "C√ºmle T√ºrleri" },
                    { name: "Fiilde √áatƒ±" },
                    { name: "Anlatƒ±m T√ºrleri" },
                    { name: "Paragraf Tamamlama" },
                    { name: "Paragraf Olu≈üturma" }
                ]
            },
            matematik: {
                name: "Matematik",
                icon: "fas fa-square-root-alt",
                colorClass: "bg-math",
                questionCount: 40,
                topics: [
                    { name: "Temel Kavramlar", subtopics: ["Doƒüal Sayƒ±lar", "Tam Sayƒ±lar", "Asal Sayƒ±lar", "Fakt√∂riyel"] },
                    { name: "Sayƒ± Basamaklarƒ±", subtopics: ["Basamak Kavramƒ±", "Basamak √á√∂z√ºmlemesi", "Sayƒ± Problemleri"] },
                    { name: "B√∂lme ve B√∂l√ºnebilme", subtopics: ["B√∂l√ºnebilme Kurallarƒ±", "Kalanlƒ± B√∂lme", "B√∂l√ºm-Kalan ƒ∞li≈ükisi"] },
                    { name: "EBOB - EKOK", subtopics: ["EBOB Bulma", "EKOK Bulma", "EBOB-EKOK Problemleri"] },
                    { name: "Rasyonel Sayƒ±lar", subtopics: ["Kesirler", "Ondalƒ±k Sayƒ±lar", "Devirli Ondalƒ±klar"] },
                    { name: "Basit E≈üitsizlikler", subtopics: ["E≈üitsizlik Kurallarƒ±", "E≈üitsizlik √á√∂z√ºm√º"] },
                    { name: "Mutlak Deƒüer", subtopics: ["Mutlak Deƒüer Tanƒ±mƒ±", "Mutlak Deƒüerli Denklemler", "Mutlak Deƒüerli E≈üitsizlikler"] },
                    { name: "√úsl√º Sayƒ±lar", subtopics: ["√ús Kurallarƒ±", "Negatif √ús", "Kesirli √ús"] },
                    { name: "K√∂kl√º Sayƒ±lar", subtopics: ["K√∂k Kavramƒ±", "K√∂k Kurallarƒ±", "K√∂kl√º ƒ∞fadelerde ƒ∞≈ülemler"] },
                    { name: "√áarpanlara Ayƒ±rma", subtopics: ["Ortak √áarpan", "√ñzde≈ülikler", "Gruplandƒ±rma"] },
                    { name: "Oran - Orantƒ±", subtopics: ["Oran", "Doƒüru Orantƒ±", "Ters Orantƒ±", "Bile≈üik Orantƒ±"] },
                    { name: "Denklem √á√∂zme", subtopics: ["1. Dereceden Denklemler", "Denklem Kurma"] },
                    { name: "Problemler", subtopics: ["Ya≈ü Problemleri", "ƒ∞≈ü√ßi Problemleri", "Havuz Problemleri", "Hareket Problemleri", "Karƒ±≈üƒ±m Problemleri", "Y√ºzde Problemleri", "Kar-Zarar Problemleri"] },
                    { name: "K√ºmeler", subtopics: ["K√ºme Kavramƒ±", "Alt K√ºme", "K√ºme ƒ∞≈ülemleri", "Venn ≈ûemalarƒ±"] },
                    { name: "Fonksiyonlar", subtopics: ["Fonksiyon Tanƒ±mƒ±", "Fonksiyon √áe≈üitleri", "Bile≈üke Fonksiyon", "Ters Fonksiyon"] },
                    { name: "Mantƒ±k", subtopics: ["√ñnermeler", "Bile≈üik √ñnermeler", "Ko≈üullu √ñnermeler"] },
                    { name: "Polinomlar", subtopics: ["Polinom Tanƒ±mƒ±", "Polinom ƒ∞≈ülemleri", "√áarpanlara Ayƒ±rma"] },
                    { name: "2. Dereceden Denklemler", subtopics: ["√á√∂z√ºm Y√∂ntemleri", "Diskriminant", "K√∂k-Katsayƒ± ƒ∞li≈ükisi"] },
                    { name: "Perm√ºtasyon", subtopics: ["Perm√ºtasyon Kavramƒ±", "Tekrarlƒ± Perm√ºtasyon"] },
                    { name: "Kombinasyon", subtopics: ["Kombinasyon Kavramƒ±", "Pascal √ú√ßgeni"] },
                    { name: "Binom", subtopics: ["Binom A√ßƒ±lƒ±mƒ±", "Genel Terim"] },
                    { name: "Olasƒ±lƒ±k", subtopics: ["Olasƒ±lƒ±k Kavramƒ±", "Ko≈üullu Olasƒ±lƒ±k", "Baƒüƒ±msƒ±z Olaylar"] },
                    { name: "ƒ∞statistik", subtopics: ["Ortalama", "Medyan", "Mod", "Standart Sapma"] },
                    { name: "Karma≈üƒ±k Sayƒ±lar", subtopics: ["Karma≈üƒ±k Sayƒ± Tanƒ±mƒ±", "ƒ∞≈ülemler", "Karma≈üƒ±k Sayƒ±nƒ±n Mod√ºl√º"] }
                ]
            },
            fizik: {
                name: "Fizik",
                icon: "fas fa-atom",
                colorClass: "bg-physics",
                questionCount: 7,
                topics: [
                    { name: "Fizik Bilimine Giri≈ü", subtopics: ["Fiziksel B√ºy√ºkl√ºkler", "Birim Sistemleri", "Bilimsel G√∂sterim"] },
                    { name: "Madde ve √ñzellikleri", subtopics: ["K√ºtle", "Hacim", "√ñzk√ºtle", "Dayanƒ±klƒ±lƒ±k"] },
                    { name: "Hareket ve Kuvvet", subtopics: ["D√ºzg√ºn Doƒürusal Hareket", "D√ºzg√ºn Hƒ±zlanan Hareket", "Serbest D√º≈üme"] },
                    { name: "Enerji", subtopics: ["Kinetik Enerji", "Potansiyel Enerji", "Enerjinin Korunumu"] },
                    { name: "Isƒ± ve Sƒ±caklƒ±k", subtopics: ["Isƒ± Kavramƒ±", "Sƒ±caklƒ±k Kavramƒ±", "Isƒ± Alƒ±≈üveri≈üi", "Hal Deƒüi≈üimi"] },
                    { name: "Elektrostatik", subtopics: ["Elektrik Y√ºk√º", "Coulomb Yasasƒ±", "Elektrik Alan"] },
                    { name: "Elektrik Akƒ±mƒ±", subtopics: ["Akƒ±m", "Diren√ß", "Ohm Yasasƒ±", "Devre Elemanlarƒ±"] },
                    { name: "Manyetizma", subtopics: ["Mƒ±knatƒ±slar", "Manyetik Alan", "Elektromƒ±knatƒ±s"] },
                    { name: "Basƒ±n√ß ve Kaldƒ±rma Kuvveti", subtopics: ["Katƒ± Basƒ±ncƒ±", "Sƒ±vƒ± Basƒ±ncƒ±", "Gaz Basƒ±ncƒ±", "Kaldƒ±rma Kuvveti"] },
                    { name: "Dalgalar", subtopics: ["Dalga √áe≈üitleri", "Dalga √ñzellikleri", "Ses Dalgalarƒ±"] },
                    { name: "Optik", subtopics: ["I≈üƒ±k ve √ñzellikleri", "Yansƒ±ma", "Kƒ±rƒ±lma", "Aynalar", "Mercekler"] }
                ]
            },
            kimya: {
                name: "Kimya",
                icon: "fas fa-flask",
                colorClass: "bg-chemistry",
                questionCount: 7,
                topics: [
                    { name: "Kimya Bilimi", subtopics: ["Kimyanƒ±n √ñnemi", "Madde ve √ñzellikleri", "Simyadan Kimyaya"] },
                    { name: "Atom ve Periyodik Sistem", subtopics: ["Atom Modelleri", "Elektron Dizilimi", "Periyodik Tablo", "Periyodik √ñzellikler"] },
                    { name: "Kimyasal T√ºrler Arasƒ± Etkile≈üimler", subtopics: ["Kimyasal Baƒülar", "ƒ∞yonik Baƒü", "Kovalent Baƒü", "Metalik Baƒü"] },
                    { name: "Maddenin Halleri", subtopics: ["Katƒ±", "Sƒ±vƒ±", "Gaz", "Plazma", "Hal Deƒüi≈üimleri"] },
                    { name: "Doƒüa ve Kimya", subtopics: ["Su ve Hayat", "Hava ve Hayat", "Toprak ve Hayat"] },
                    { name: "Kimyasal Tepkimeler", subtopics: ["Tepkime Denklemleri", "Tepkime T√ºrleri", "Denkle≈ütirme"] },
                    { name: "Kimya Her Yerde", subtopics: ["Temizlik Maddeleri", "Kozmetikler", "Polimerler"] },
                    { name: "Asitler ve Bazlar", subtopics: ["Asit Kavramƒ±", "Baz Kavramƒ±", "pH", "ƒ∞ndikat√∂rler"] },
                    { name: "Karƒ±≈üƒ±mlar", subtopics: ["Homojen Karƒ±≈üƒ±mlar", "Heterojen Karƒ±≈üƒ±mlar", "Ayƒ±rma Y√∂ntemleri"] }
                ]
            },
            biyoloji: {
                name: "Biyoloji",
                icon: "fas fa-dna",
                colorClass: "bg-biology",
                questionCount: 6,
                topics: [
                    { name: "Canlƒ±larƒ±n Ortak √ñzellikleri", subtopics: ["H√ºcresel Yapƒ±", "Beslenme", "Solunum", "Bo≈üaltƒ±m", "Hareket", "√úreme"] },
                    { name: "Canlƒ±larƒ±n Temel Bile≈üenleri", subtopics: ["Su", "Mineraller", "Karbonhidratlar", "Yaƒülar", "Proteinler", "Vitaminler", "N√ºkleik Asitler"] },
                    { name: "H√ºcre ve Organeller", subtopics: ["H√ºcre Zarƒ±", "Sitoplazma", "√áekirdek", "Organeller", "H√ºcre B√∂l√ºnmesi"] },
                    { name: "Canlƒ±larƒ±n Sƒ±nƒ±flandƒ±rƒ±lmasƒ±", subtopics: ["Sƒ±nƒ±flandƒ±rma Kriterleri", "Alemler", "Vir√ºsler"] },
                    { name: "Mitoz ve E≈üeysiz √úreme", subtopics: ["Mitoz B√∂l√ºnme", "E≈üeysiz √úreme √áe≈üitleri"] },
                    { name: "Mayoz ve E≈üeyli √úreme", subtopics: ["Mayoz B√∂l√ºnme", "Gametogenez", "D√∂llenme"] },
                    { name: "Kalƒ±tƒ±m", subtopics: ["Mendel Genetiƒüi", "Kalƒ±tƒ±m √áe≈üitleri", "Soy Aƒüacƒ± Analizi"] },
                    { name: "Ekosistem Ekolojisi", subtopics: ["Ekosistem Kavramƒ±", "Besin Zinciri", "Enerji Akƒ±≈üƒ±", "Madde D√∂ng√ºleri"] },
                    { name: "G√ºncel √áevre Sorunlarƒ±", subtopics: ["K√ºresel Isƒ±nma", "Su Kirliliƒüi", "Hava Kirliliƒüi", "Biyolojik √áe≈üitlilik"] }
                ]
            },
            tarih: {
                name: "Tarih",
                icon: "fas fa-landmark",
                colorClass: "bg-social",
                questionCount: 5,
                topics: [
                    { name: "Tarih Bilimi" },
                    { name: "ƒ∞lk √áaƒü Uygarlƒ±klarƒ±" },
                    { name: "ƒ∞lk T√ºrk Devletleri" },
                    { name: "ƒ∞slam Tarihi ve Uygarlƒ±ƒüƒ±" },
                    { name: "T√ºrk-ƒ∞slam Devletleri" },
                    { name: "Osmanlƒ± Kurulu≈ü D√∂nemi" },
                    { name: "Osmanlƒ± Y√ºkselme D√∂nemi" },
                    { name: "Osmanlƒ± Duraklama D√∂nemi" },
                    { name: "Osmanlƒ± Gerileme D√∂nemi" },
                    { name: "Osmanlƒ± Daƒüƒ±lma D√∂nemi" },
                    { name: "Kurtulu≈ü Sava≈üƒ± Hazƒ±rlƒ±k" },
                    { name: "Kurtulu≈ü Sava≈üƒ± Muharebeler" },
                    { name: "ƒ∞nkƒ±laplar" },
                    { name: "Atat√ºrk ƒ∞lkeleri" },
                    { name: "Atat√ºrk D√∂nemi Dƒ±≈ü Politika" }
                ]
            },
            cografya: {
                name: "Coƒürafya",
                icon: "fas fa-globe-europe",
                colorClass: "bg-science",
                questionCount: 5,
                topics: [
                    { name: "Coƒürafi Konum" },
                    { name: "Harita Bilgisi" },
                    { name: "D√ºnya'nƒ±n ≈ûekli ve Hareketleri" },
                    { name: "ƒ∞klim Bilgisi" },
                    { name: "T√ºrkiye'nin ƒ∞klimi" },
                    { name: "Yery√ºz√º ≈ûekilleri" },
                    { name: "T√ºrkiye'nin Yery√ºz√º ≈ûekilleri" },
                    { name: "N√ºfus ve Yerle≈üme" },
                    { name: "T√ºrkiye'de N√ºfus" },
                    { name: "Ekonomik Faaliyetler" },
                    { name: "Doƒüal Afetler" }
                ]
            },
            felsefe: {
                name: "Felsefe",
                icon: "fas fa-brain",
                colorClass: "bg-turkish",
                questionCount: 5,
                topics: [
                    { name: "Felsefenin Konusu" },
                    { name: "Bilgi Felsefesi" },
                    { name: "Varlƒ±k Felsefesi" },
                    { name: "Ahlak Felsefesi" },
                    { name: "Sanat Felsefesi" },
                    { name: "Din Felsefesi" },
                    { name: "Siyaset Felsefesi" }
                ]
            },
            din: {
                name: "Din K√ºlt√ºr√º",
                icon: "fas fa-mosque",
                colorClass: "bg-chemistry",
                questionCount: 5,
                topics: [
                    { name: "Din ve ƒ∞slam" },
                    { name: "ƒ∞slam'ƒ±n ƒ∞nan√ß Esaslarƒ±" },
                    { name: "ƒ∞slam'ƒ±n ƒ∞badet Esaslarƒ±" },
                    { name: "Hz. Muhammed'in Hayatƒ±" },
                    { name: "Kur'an ve Yorumlanmasƒ±" },
                    { name: "ƒ∞slam D√º≈ü√ºncesinde Yorumlar" },
                    { name: "ƒ∞slam ve Bilim" },
                    { name: "ƒ∞slam ve Ahlak" }
                ]
            }
        };

        // AYT Sayƒ±sal Konularƒ±
        const aytSubjects = {
            matematik: {
                name: "Matematik",
                icon: "fas fa-calculator",
                colorClass: "bg-math",
                questionCount: 40,
                topics: [
                    { name: "Temel Kavramlar ve Sayƒ±lar", subtopics: ["Sayƒ± K√ºmeleri", "Rasyonel ve ƒ∞rrasyonel Sayƒ±lar"] },
                    { name: "Fonksiyonlar", subtopics: ["Fonksiyon √áe≈üitleri", "Grafik √áizimi", "Tek-√áift Fonksiyon", "Artan-Azalan"] },
                    { name: "Polinomlar", subtopics: ["Polinom ƒ∞≈ülemleri", "B√∂lme", "√áarpanlara Ayƒ±rma", "K√∂kler"] },
                    { name: "ƒ∞kinci Dereceden Denklemler", subtopics: ["√á√∂z√ºm Y√∂ntemleri", "K√∂k-Katsayƒ± ƒ∞li≈ükisi", "Parabol"] },
                    { name: "Denklem ve E≈üitsizlik Sistemleri", subtopics: ["Lineer Sistemler", "Parametreli Sistemler"] },
                    { name: "√ústel ve Logaritmik Fonksiyonlar", subtopics: ["√ústel Fonksiyonlar", "Logaritma", "Doƒüal Logaritma"] },
                    { name: "Diziler", subtopics: ["Aritmetik Dizi", "Geometrik Dizi", "Fibonacci", "Genel Terim"] },
                    { name: "Trigonometri", subtopics: ["Trigonometrik Oranlar", "Birim √áember", "Trigonometrik Fonksiyonlar", "Ters Trigonometrik Fonksiyonlar", "Toplam-Fark Form√ºlleri"] },
                    { name: "Analitik Geometri", subtopics: ["Doƒüru Denklemi", "ƒ∞ki Doƒürunun Durumu", "Nokta-Doƒüru Uzaklƒ±ƒüƒ±", "√áember Denklemi"] },
                    { name: "Limit ve S√ºreklilik", subtopics: ["Limit Kavramƒ±", "Limit Alma Kurallarƒ±", "Belirsizlik", "S√ºreklilik"] },
                    { name: "T√ºrev", subtopics: ["T√ºrev Tanƒ±mƒ±", "T√ºrev Kurallarƒ±", "Bile≈üke Fonksiyonun T√ºrevi", "Trigonometrik T√ºrev", "√ústel ve Logaritmik T√ºrev"] },
                    { name: "T√ºrev Uygulamalarƒ±", subtopics: ["Teƒüet ve Normal", "Artan-Azalan", "Ekstremum", "B√ºk√ºm Noktasƒ±", "Maksimum-Minimum Problemleri"] },
                    { name: "ƒ∞ntegral", subtopics: ["Belirsiz ƒ∞ntegral", "ƒ∞ntegral Kurallarƒ±", "Deƒüi≈üken Deƒüi≈ütirme", "Kƒ±smi ƒ∞ntegral"] },
                    { name: "ƒ∞ntegral Uygulamalarƒ±", subtopics: ["Belirli ƒ∞ntegral", "Alan Hesabƒ±", "Hacim Hesabƒ±"] }
                ]
            },
            geometri: {
                name: "Geometri",
                icon: "fas fa-shapes",
                colorClass: "bg-geometry",
                questionCount: 10,
                topics: [
                    { name: "Temel Kavramlar", subtopics: ["Nokta-Doƒüru-D√ºzlem", "A√ßƒ± √áe≈üitleri", "A√ßƒ± √ñl√ßme"] },
                    { name: "Doƒüruda ve √ú√ßgende A√ßƒ±lar", subtopics: ["Doƒüruda A√ßƒ±lar", "Paralel Doƒürularda A√ßƒ±lar", "√ú√ßgende A√ßƒ±lar"] },
                    { name: "√ú√ßgenler", subtopics: ["√ú√ßgen √áe≈üitleri", "√ú√ßgende Temel Elemanlar", "√ú√ßgen E≈üitliƒüi"] },
                    { name: "√ú√ßgende Benzerlik", subtopics: ["Benzerlik Kriterleri", "Benzerlik Uygulamalarƒ±"] },
                    { name: "√ú√ßgende A√ßƒ±-Kenar Baƒüƒ±ntƒ±larƒ±", subtopics: ["Sin√ºs Teoremi", "Kosin√ºs Teoremi", "A√ßƒ±-Kenar ƒ∞li≈ükisi"] },
                    { name: "√ú√ßgende Alan", subtopics: ["Alan Form√ºlleri", "Y√ºkseklik", "Kenarortay", "A√ßƒ±ortay"] },
                    { name: "√áokgenler", subtopics: ["√áokgen √áe≈üitleri", "D√ºzg√ºn √áokgenler", "√áokgende A√ßƒ± ve K√∂≈üegen"] },
                    { name: "D√∂rtgenler", subtopics: ["Paralelkenar", "Dikd√∂rtgen", "Kare", "E≈ükenar D√∂rtgen", "Yamuk"] },
                    { name: "√áember ve Daire", subtopics: ["√áember Elemanlarƒ±", "Merkez A√ßƒ±", "√áevre A√ßƒ±", "Kiri≈ü-Teƒüet", "Daire Alan"] },
                    { name: "Katƒ± Cisimler", subtopics: ["Prizma", "Piramit", "Silindir", "Koni", "K√ºre"] },
                    { name: "Analitik Geometri", subtopics: ["Koordinat Sistemi", "ƒ∞ki Nokta Arasƒ± Uzaklƒ±k", "B√∂lme Baƒüƒ±ntƒ±sƒ±"] },
                    { name: "Koordinat D√ºzlemi", subtopics: ["Nokta ve Doƒüru", "√ú√ßgenin Alanƒ±"] },
                    { name: "Doƒürunun Analitik ƒ∞ncelenmesi", subtopics: ["Doƒüru Denklemi", "Eƒüim", "Paralel ve Dik Doƒürular"] },
                    { name: "√áemberin Analitik ƒ∞ncelenmesi", subtopics: ["√áember Denklemi", "Teƒüet Doƒüru", "√áemberlerin Durumu"] },
                    { name: "D√∂n√º≈ü√ºmler", subtopics: ["√ñteleme", "Yansƒ±ma", "D√∂nme", "Homoteti"] }
                ]
            },
            fizik: {
                name: "Fizik",
                icon: "fas fa-bolt",
                colorClass: "bg-physics",
                questionCount: 14,
                topics: [
                    { name: "Vekt√∂rler", subtopics: ["Vekt√∂r Kavramƒ±", "Vekt√∂rel ƒ∞≈ülemler", "Bile≈üke Vekt√∂r"] },
                    { name: "Kuvvet ve Hareket", subtopics: ["Newton Yasalarƒ±", "Aƒüƒ±rlƒ±k ve K√ºtle", "S√ºrt√ºnme Kuvveti"] },
                    { name: "Dinamik", subtopics: ["D√ºzg√ºn √áembersel Hareket", "Merkezcil Kuvvet", "Genel √áekim"] },
                    { name: "ƒ∞≈ü, G√º√ß ve Enerji", subtopics: ["ƒ∞≈ü", "G√º√ß", "Enerji √áe≈üitleri", "Enerji Korunumu"] },
                    { name: "ƒ∞tme ve Momentum", subtopics: ["Momentum", "ƒ∞tme", "√áarpƒ±≈ümalar", "Momentum Korunumu"] },
                    { name: "Tork ve Denge", subtopics: ["Tork", "Denge √áe≈üitleri", "Aƒüƒ±rlƒ±k Merkezi"] },
                    { name: "Basit Harmonik Hareket", subtopics: ["BHH Tanƒ±mƒ±", "Yay-K√ºtle Sistemi", "Sarka√ß"] },
                    { name: "Dalga Mekaniƒüi", subtopics: ["Dalga √ñzellikleri", "Ses Dalgalarƒ±", "Doppler Etkisi"] },
                    { name: "Elektrik Alan ve Potansiyel", subtopics: ["Elektrik Alan", "Potansiyel", "Sƒ±ƒüa", "Kondansat√∂rler"] },
                    { name: "Manyetik Alan ve Kuvvet", subtopics: ["Manyetik Alan", "Akƒ±m Ta≈üƒ±yan Telde Kuvvet", "Y√ºkl√º Par√ßacƒ±klarda Kuvvet"] },
                    { name: "Elektromanyetik ƒ∞nd√ºksiyon", subtopics: ["Faraday Yasasƒ±", "Lenz Yasasƒ±", "ƒ∞nd√ºksiyon"] },
                    { name: "Alternatif Akƒ±m", subtopics: ["AC Devreleri", "Transformat√∂r"] },
                    { name: "I≈üƒ±k ve Optik", subtopics: ["I≈üƒ±ƒüƒ±n Doƒüasƒ±", "Giri≈üim", "Kƒ±rƒ±nƒ±m", "Polarizasyon"] },
                    { name: "Atom Fiziƒüine Giri≈ü", subtopics: ["Atom Modelleri", "Fotoelektrik Olay", "Compton Olayƒ±"] },
                    { name: "Radyoaktivite", subtopics: ["Radyoaktif Bozunma", "Yarƒ± √ñm√ºr", "Bozunma T√ºrleri"] },
                    { name: "Modern Fizik", subtopics: ["√ñzel G√∂relilik", "K√ºtle-Enerji Denkliƒüi"] }
                ]
            },
            kimya: {
                name: "Kimya",
                icon: "fas fa-vial",
                colorClass: "bg-chemistry",
                questionCount: 13,
                topics: [
                    { name: "Modern Atom Teorisi", subtopics: ["Kuantum Sayƒ±larƒ±", "Orbital Kavramƒ±", "Elektron Dizilimi"] },
                    { name: "Gazlar", subtopics: ["ƒ∞deal Gaz Yasasƒ±", "Gaz Karƒ±≈üƒ±mlarƒ±", "Ger√ßek Gazlar"] },
                    { name: "Sƒ±vƒ± √á√∂zeltiler ve √á√∂z√ºn√ºrl√ºk", subtopics: ["Deri≈üim Birimleri", "Koligatif √ñzellikler", "√á√∂z√ºn√ºrl√ºk"] },
                    { name: "Kimyasal Tepkimelerde Enerji", subtopics: ["Entalpi", "Hess Yasasƒ±", "Baƒü Enerjisi"] },
                    { name: "Kimyasal Tepkimelerde Hƒ±z", subtopics: ["Tepkime Hƒ±zƒ±", "Hƒ±za Etki Eden Fakt√∂rler", "Aktifle≈üme Enerjisi"] },
                    { name: "Kimyasal Tepkimelerde Denge", subtopics: ["Denge Sabiti", "Le Chatelier ƒ∞lkesi", "Denge Hesaplamalarƒ±"] },
                    { name: "Asit-Baz Dengesi", subtopics: ["pH ve pOH", "Tampon √á√∂zeltiler", "Titrasyon"] },
                    { name: "√á√∂z√ºn√ºrl√ºk Dengesi", subtopics: ["√á√∂z√ºn√ºrl√ºk √áarpƒ±mƒ±", "√á√∂kt√ºrme"] },
                    { name: "Elektrokimya", subtopics: ["Redoks Tepkimeleri", "Piller", "Elektroliz"] },
                    { name: "Organik Kimyaya Giri≈ü", subtopics: ["Organik Bile≈üikler", "Hibridle≈üme", "ƒ∞zomeri"] },
                    { name: "Hidrokarbonlar", subtopics: ["Alkanlar", "Alkenler", "Alkinler", "Aromatikler"] },
                    { name: "Fonksiyonel Gruplar", subtopics: ["Alkoller", "Eterler", "Aldehitler", "Ketonlar", "Karboksilli Asitler", "Esterler", "Aminler"] },
                    { name: "Organik Tepkimeler", subtopics: ["Yanma", "Yer Deƒüi≈ütirme", "Katƒ±lma", "Eliminasyon"] },
                    { name: "Enerji Kaynaklarƒ±", subtopics: ["Fosil Yakƒ±tlar", "N√ºkleer Enerji", "Yenilenebilir Enerji"] }
                ]
            },
            biyoloji: {
                name: "Biyoloji",
                icon: "fas fa-leaf",
                colorClass: "bg-biology",
                questionCount: 13,
                topics: [
                    { name: "N√ºkleik Asitler ve Protein Sentezi", subtopics: ["DNA Yapƒ±sƒ±", "RNA √áe≈üitleri", "Replikasyon", "Transkripsiyon", "Translasyon"] },
                    { name: "Canlƒ±larda Enerji D√∂n√º≈ü√ºmleri", subtopics: ["ATP", "Enzimler"] },
                    { name: "Fotosentez", subtopics: ["I≈üƒ±k Reaksiyonlarƒ±", "Karbon Reaksiyonlarƒ±", "Fotosentez Hƒ±zƒ±"] },
                    { name: "Kemosentez", subtopics: ["Kemosentez Yapan Canlƒ±lar", "Kemosentez Reaksiyonlarƒ±"] },
                    { name: "H√ºcresel Solunum", subtopics: ["Glikoliz", "Krebs D√∂ng√ºs√º", "ETS", "Fermantasyon"] },
                    { name: "Canlƒ±larda Sindirim", subtopics: ["Sindirim Sistemi", "Sindirim Enzimleri", "Emilim"] },
                    { name: "Canlƒ±larda Solunum", subtopics: ["Solunum Sistemi", "Gaz Deƒüi≈üimi", "Solunum √áe≈üitleri"] },
                    { name: "Canlƒ±larda Dola≈üƒ±m", subtopics: ["Dola≈üƒ±m Sistemi", "Kan", "Kalp", "Damarlar", "Lenf Sistemi"] },
                    { name: "Canlƒ±larda Bo≈üaltƒ±m", subtopics: ["Bo≈üaltƒ±m Sistemi", "Nefron", "ƒ∞drar Olu≈üumu"] },
                    { name: "Canlƒ±larda D√ºzenleyici Sistemler", subtopics: ["Geri Bildirim", "Homeostazi"] },
                    { name: "Sinir Sistemi", subtopics: ["N√∂ron", "Sinir ƒ∞letimi", "Merkezi Sinir Sistemi", "√áevresel Sinir Sistemi"] },
                    { name: "Endokrin Sistem", subtopics: ["Hormonlar", "Endokrin Bezler", "Hormon D√ºzenlenmesi"] },
                    { name: "Duyu Organlarƒ±", subtopics: ["G√∂z", "Kulak", "Burun", "Dil", "Deri"] },
                    { name: "Destek ve Hareket Sistemi", subtopics: ["Kemikler", "Eklemler", "Kaslar"] },
                    { name: "√úreme Sistemi", subtopics: ["Erkek √úreme Sistemi", "Di≈üi √úreme Sistemi", "Embriyonik Geli≈üim"] },
                    { name: "Kom√ºnite ve Pop√ºlasyon Ekolojisi", subtopics: ["Pop√ºlasyon Dinamiƒüi", "T√ºrler Arasƒ± ƒ∞li≈ükiler", "S√ºksesyon"] },
                    { name: "Biyoteknoloji ve Genetik M√ºhendisliƒüi", subtopics: ["Gen Klonlama", "PCR", "GDO", "Gen Terapisi"] }
                ]
            }
        };

        // Motivasyon S√∂zleri
        const quotes = [
            { text: "Ey y√ºkselen yeni nesil, gelecek sizindir. Cumhuriyeti biz kurduk; onu y√ºkseltecek ve s√ºrd√ºrecek sizsiniz.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Bir g√ºn ulusu sizin gibi beni anlamƒ±≈ü gen√ßliƒüe bƒ±rakacaƒüƒ±mdan √ßok memnun ve mesudum.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Milletin baƒürƒ±nda temiz bir nesil yeti≈üiyor. Bu eser (T√ºrkiye Cumhuriyeti Devleti) ona bƒ±rakacaƒüƒ±m ve g√∂z√ºm arkamda olmayacak.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "K√º√ß√ºk hanƒ±mlar, k√º√ß√ºk beyler! Sizler hepiniz geleceƒüin bir g√ºl√º, yƒ±ldƒ±zƒ± ve ikbal ƒ±≈üƒ±ƒüƒ±sƒ±nƒ±z. Memleketi asƒ±l ƒ±≈üƒ±ƒüa boƒüacak olan sizsiniz. Kendinizin ne kadar √∂nemli, deƒüerli olduƒüunuzu d√º≈ü√ºnerek ona g√∂re √ßalƒ±≈üƒ±nƒ±z. Sizlerden √ßok ≈üey bekliyoruz.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Hayatta en hakiki m√ºr≈üit ilimdir.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "ƒ∞lim ve fen nerede ise oradan alacaƒüƒ±z ve her millet ferdinin kafasƒ±na koyacaƒüƒ±z.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Okumak, anlamak, g√∂rebilmek, g√∂rebildiƒüinden anlam √ßƒ±karmak ve baƒüƒ±msƒ±z d√º≈ü√ºnebilmek i√ßin okumak gerekir.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Benim en b√ºy√ºk eserim T√ºrk gen√ßliƒüidir.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Gen√ßler cesaretimizi takviye ve idame eden sizlersiniz. Siz, almakta olduƒüunuz terbiye ve irfan ile insanlƒ±k ve medeniyetin, vatan sevgisinin, fikir h√ºrriyetinin en kƒ±ymetli timsali olacaksƒ±nƒ±z.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "T√ºrk √ßocuƒüu ecdadƒ±nƒ± tanƒ±dƒ±k√ßa daha b√ºy√ºk i≈üler yapmak i√ßin kendinde kuvvet bulacaktƒ±r.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Gelecek i√ßin hazƒ±rlanan vatan evlatlarƒ±na, hi√ßbir g√º√ßl√ºk kar≈üƒ±sƒ±nda yƒ±lmayarak tam bir sabƒ±r ve metanetle √ßalƒ±≈ümalarƒ±nƒ± tavsiye ederim.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Muallimler! Yeni nesli, Cumhuriyetin fedak√¢r √∂ƒüretmen ve eƒüitimcileri, sizler yeti≈ütireceksiniz.", author: "Mustafa Kemal Atat√ºrk" },
            { text: "Eƒüitimdir ki bir milleti ya √∂zg√ºr, baƒüƒ±msƒ±z, ≈üanlƒ±, y√ºksek bir topluluk halinde ya≈üatƒ±r; ya da esaret ve sefalete terk eder.", author: "Mustafa Kemal Atat√ºrk" },
        ];

        let currentUser = null;
        let userData = {};
        let currentDenemeType = 'tyt';
        let currentModalSubject = null;
        let tempWrongTopics = {};
        let editingDenemeId = null;
        let isSaving = false;
        let currentBransCategory = 'matematik';
        let currentBransDers = '';

        // Special users for love message
        const specialUsers = ['yok', 'yok', 'yok'];

        // Bran≈ü kategorileri ve dersleri
        const bransKategorileri = {
            matematik: {
                name: 'Matematik',
                dersler: ['matematik', 'geometri']
            },
            geometri: {
                name: 'Geometri',
                dersler: ['geometri']
            },
            turkce: {
                name: 'T√ºrk√ße',
                dersler: ['turkce']
            },
            fen: {
                name: 'Fen',
                dersler: ['fizik', 'kimya', 'biyoloji']
            },
            sosyal: {
                name: 'Sosyal',
                dersler: ['tarih', 'cografya', 'felsefe', 'din']
            }
        };

        // Helper function to get topic count
        function getTopicCount(subjects) {
            let count = 0;
            for (const subject of Object.values(subjects)) {
                count += subject.topics.length;
                subject.topics.forEach(t => { count += t.subtopics?.length || 0; });
            }
            return count;
        }

        // Login Function
        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (username.length < 2) {
                document.getElementById('usernameInput').style.borderColor = '#f43f5e';
                return;
            }
            
            // Show loading
            const loginBtn = document.querySelector('.login-btn');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Y√ºkleniyor...';
            loginBtn.disabled = true;
            
            try {
                currentUser = username;
                localStorage.setItem('yks_lastUser', username);
                await loadUserData();
                showApp();
            } catch (error) {
                console.error('Giri≈ü hatasƒ±:', error);
                alert('Baƒülantƒ± hatasƒ±! L√ºtfen tekrar deneyin.');
            } finally {
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }
        }

        document.getElementById('usernameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });

        async function loadUserData() {
            try {
                // Try to load from Firebase first
                const doc = await db.collection('users').doc(currentUser).get();
                if (doc.exists) {
                    userData = doc.data();
                } else {
                    // Check localStorage for migration
                    const localData = localStorage.getItem(`yks_${currentUser}`);
                    if (localData) {
                        userData = JSON.parse(localData);
                        // Migrate to Firebase
                        await saveUserData();
                    } else {
                        userData = { tyt: {}, ayt: {}, denemeler: [], wrongTopics: { tyt: {}, ayt: {} }, theme: 'purple' };
                    }
                }
            } catch (error) {
                console.error('Firebase y√ºkleme hatasƒ±:', error);
                // Fallback to localStorage
                const localData = localStorage.getItem(`yks_${currentUser}`);
                if (localData) {
                    userData = JSON.parse(localData);
                } else {
                    userData = { tyt: {}, ayt: {}, denemeler: [], wrongTopics: { tyt: {}, ayt: {} }, theme: 'purple' };
                }
            }
            
            if (!userData.wrongTopics) userData.wrongTopics = { tyt: {}, ayt: {} };
            if (!userData.denemeler) userData.denemeler = [];
            if (!userData.bransDenemeler) userData.bransDenemeler = [];
            if (!userData.theme) userData.theme = 'purple';
        }

        async function saveUserData() {
            // Always save to localStorage as backup
            localStorage.setItem(`yks_${currentUser}`, JSON.stringify(userData));
            
            // Save to Firebase (debounced)
            if (isSaving) return;
            isSaving = true;
            
            try {
                await db.collection('users').doc(currentUser).set(userData);
            } catch (error) {
                console.error('Firebase kaydetme hatasƒ±:', error);
            } finally {
                setTimeout(() => { isSaving = false; }, 500);
            }
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('displayName').textContent = currentUser;

            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('motivationQuote').innerHTML = `"${quote.text}"`;
            document.querySelector('.motivation-card .author').textContent = `- ${quote.author}`;
            document.getElementById('denemeDate').valueAsDate = new Date();

            // Apply saved theme
            applyTheme(userData.theme || 'purple');

            // Check for special users
            if (specialUsers.includes(currentUser.toLowerCase())) {
                showLoveModal();
            }

            renderSubjects();
            updateStats();
            renderCharts();
            renderDenemeForms();
            renderEksikKonular();
            renderDenemeHistory();
        }

        function logout() {
            currentUser = null;
            userData = {};
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('usernameInput').value = '';
            document.documentElement.removeAttribute('data-theme');
        }

        // Love Modal Functions
        function showLoveModal() {
            const overlay = document.getElementById('loveModalOverlay');
            overlay.classList.add('active');
            createFloatingHearts();
        }

        function closeLoveModal() {
            const overlay = document.getElementById('loveModalOverlay');
            overlay.classList.remove('active');
            document.getElementById('floatingHearts').innerHTML = '';
        }

        function createFloatingHearts() {
            const container = document.getElementById('floatingHearts');
            const hearts = ['üíï', 'üíñ', 'üíó', 'üíì', 'üíù', '‚ù§Ô∏è', 'üíò', 'üíû'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const heart = document.createElement('span');
                    heart.className = 'floating-heart';
                    heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                    heart.style.left = Math.random() * 100 + '%';
                    heart.style.animationDelay = Math.random() * 2 + 's';
                    heart.style.fontSize = (Math.random() * 1.5 + 1) + 'rem';
                    container.appendChild(heart);
                }, i * 150);
            }
        }

        // Theme Functions
        function toggleThemeDropdown() {
            const dropdown = document.getElementById('themeDropdown');
            dropdown.classList.toggle('open');
        }

        function setTheme(theme) {
            userData.theme = theme;
            saveUserData();
            applyTheme(theme);
            document.getElementById('themeDropdown').classList.remove('open');
        }

        function applyTheme(theme) {
            // Remove custom styles first
            document.documentElement.style.removeProperty('--primary');
            document.documentElement.style.removeProperty('--primary-light');
            document.documentElement.style.removeProperty('--secondary');
            document.documentElement.style.removeProperty('--accent');
            document.documentElement.style.removeProperty('--bg-gradient');
            document.documentElement.style.removeProperty('--text');
            document.documentElement.style.removeProperty('--text-light');

            if (theme === 'purple') {
                document.documentElement.removeAttribute('data-theme');
            } else if (theme.startsWith('#')) {
                // Custom color
                document.documentElement.removeAttribute('data-theme');
                applyCustomTheme(theme);
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            
            // Update active state on color buttons
            document.querySelectorAll('.theme-color').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });

            // Update color picker value if custom
            if (theme.startsWith('#')) {
                document.getElementById('customColorPicker').value = theme;
            }
        }

        function applyCustomColor() {
            const color = document.getElementById('customColorPicker').value;
            userData.theme = color;
            saveUserData();
            applyTheme(color);
            
            // Remove active from preset colors
            document.querySelectorAll('.theme-color').forEach(btn => btn.classList.remove('active'));
        }

        function applyCustomTheme(hexColor) {
            const r = parseInt(hexColor.slice(1, 3), 16);
            const g = parseInt(hexColor.slice(3, 5), 16);
            const b = parseInt(hexColor.slice(5, 7), 16);

            // Generate lighter version
            const lighten = (c, percent) => Math.min(255, Math.floor(c + (255 - c) * percent));
            const darken = (c, percent) => Math.floor(c * (1 - percent));

            const primaryLight = `rgb(${lighten(r, 0.4)}, ${lighten(g, 0.4)}, ${lighten(b, 0.4)})`;
            const secondary = `rgb(${lighten(r, 0.2)}, ${lighten(g, 0.2)}, ${lighten(b, 0.2)})`;
            const accent = `rgb(${lighten(r, 0.5)}, ${lighten(g, 0.5)}, ${lighten(b, 0.5)})`;
            const textDark = `rgb(${darken(r, 0.6)}, ${darken(g, 0.6)}, ${darken(b, 0.6)})`;
            const textLight = `rgb(${darken(r, 0.3)}, ${darken(g, 0.3)}, ${darken(b, 0.3)})`;

            // Very light background
            const bgLight1 = `rgb(${lighten(r, 0.95)}, ${lighten(g, 0.95)}, ${lighten(b, 0.95)})`;
            const bgLight2 = `rgb(${lighten(r, 0.9)}, ${lighten(g, 0.9)}, ${lighten(b, 0.9)})`;
            const bgLight3 = `rgb(${lighten(r, 0.92)}, ${lighten(g, 0.92)}, ${lighten(b, 0.92)})`;

            document.documentElement.style.setProperty('--primary', hexColor);
            document.documentElement.style.setProperty('--primary-light', primaryLight);
            document.documentElement.style.setProperty('--secondary', secondary);
            document.documentElement.style.setProperty('--accent', accent);
            document.documentElement.style.setProperty('--bg-gradient', `linear-gradient(135deg, ${bgLight1} 0%, ${bgLight2} 50%, ${bgLight3} 100%)`);
            document.documentElement.style.setProperty('--text', textDark);
            document.documentElement.style.setProperty('--text-light', textLight);
        }

        // Close theme dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const themePicker = document.querySelector('.theme-picker');
            const dropdown = document.getElementById('themeDropdown');
            if (themePicker && dropdown && !themePicker.contains(e.target)) {
                dropdown.classList.remove('open');
            }
        });

        function renderSubjects() {
            renderSubjectList('tytSubjects', tytSubjects, 'tyt');
            renderSubjectList('aytSubjects', aytSubjects, 'ayt');
        }

        function renderSubjectList(containerId, subjects, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            for (const [key, subject] of Object.entries(subjects)) {
                const completedTopics = userData[type]?.[key] || [];
                const total = subject.topics.length + subject.topics.reduce((sum, t) => sum + (t.subtopics?.length || 0), 0);
                const completed = completedTopics.length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

                const card = document.createElement('div');
                card.className = 'subject-card';
                
                let topicsHtml = '';
                subject.topics.forEach((topic, tIndex) => {
                    const topicId = `${tIndex}`;
                    const isTopicCompleted = completedTopics.includes(topicId);
                    const wrongCount = getWrongCount(type, key, topicId);
                    const hasSubtopics = topic.subtopics && topic.subtopics.length > 0;
                    
                    topicsHtml += `
                        <div class="topic-item ${isTopicCompleted ? 'completed' : ''}" data-topic-id="${topicId}">
                            ${hasSubtopics ? `<button class="topic-expand-btn" onclick="event.stopPropagation(); toggleSubtopics(this, '${type}', '${key}', ${tIndex})"><i class="fas fa-plus"></i></button>` : ''}
                            <div class="topic-checkbox" onclick="toggleTopic('${type}', '${key}', '${topicId}', this.parentElement)">
                                ${isTopicCompleted ? '<i class="fas fa-check"></i>' : ''}
                            </div>
                            <span class="topic-text" onclick="toggleTopic('${type}', '${key}', '${topicId}', this.parentElement)">${topic.name}</span>
                            ${wrongCount > 0 ? `<span class="topic-wrong-count">${wrongCount} yanlƒ±≈ü</span>` : ''}
                        </div>
                        <div class="subtopics-container" id="subtopics_${type}_${key}_${tIndex}">
                            ${(topic.subtopics || []).map((sub, sIndex) => {
                                const subId = `${tIndex}_${sIndex}`;
                                const isSubCompleted = completedTopics.includes(subId);
                                const subWrongCount = getWrongCount(type, key, subId);
                                return `
                                    <div class="subtopic-item ${isSubCompleted ? 'completed' : ''}" onclick="toggleTopic('${type}', '${key}', '${subId}', this)">
                                        <div class="subtopic-checkbox">
                                            ${isSubCompleted ? '<i class="fas fa-check"></i>' : ''}
                                        </div>
                                        <span class="subtopic-text">${sub}</span>
                                        ${subWrongCount > 0 ? `<span class="topic-wrong-count">${subWrongCount}</span>` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                });

                card.innerHTML = `
                    <div class="subject-header" onclick="toggleTopics(this)">
                        <div class="subject-title">
                            <div class="subject-icon ${subject.colorClass}">
                                <i class="${subject.icon}"></i>
                            </div>
                            <h3>${subject.name}</h3>
                        </div>
                        <div class="subject-progress">
                            <div class="percentage">${percentage}%</div>
                            <div class="count">${completed} / ${total}</div>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="topics-list">${topicsHtml}</div>
                `;
                container.appendChild(card);
            }
        }

        function toggleSubtopics(btn, type, key, tIndex) {
            const container = document.getElementById(`subtopics_${type}_${key}_${tIndex}`);
            const icon = btn.querySelector('i');
            container.classList.toggle('open');
            icon.className = container.classList.contains('open') ? 'fas fa-minus' : 'fas fa-plus';
        }

        function getWrongCount(type, subject, topicId) {
            if (!userData.wrongTopics[type]?.[subject]?.[topicId]) return 0;
            return userData.wrongTopics[type][subject][topicId];
        }

        function toggleTopics(header) {
            header.classList.toggle('open');
            header.nextElementSibling.classList.toggle('open');
        }

        function toggleTopic(type, subject, topicId, element) {
            if (!userData[type][subject]) userData[type][subject] = [];
            
            const index = userData[type][subject].indexOf(topicId);
            if (index > -1) {
                userData[type][subject].splice(index, 1);
                element.classList.remove('completed');
                element.querySelector('.topic-checkbox, .subtopic-checkbox').innerHTML = '';
            } else {
                userData[type][subject].push(topicId);
                element.classList.add('completed');
                element.querySelector('.topic-checkbox, .subtopic-checkbox').innerHTML = '<i class="fas fa-check"></i>';
            }
            saveUserData();
            updateStats();
            renderCharts();
            
            // Update subject card progress instantly
            const card = element.closest('.subject-card');
            if (card) {
                const subjects = type === 'tyt' ? tytSubjects : aytSubjects;
                const subjectData = subjects[subject];
                const total = subjectData.topics.length + subjectData.topics.reduce((sum, t) => sum + (t.subtopics?.length || 0), 0);
                const completed = (userData[type][subject] || []).length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                card.querySelector('.percentage').textContent = percentage + '%';
                card.querySelector('.count').textContent = `${completed} / ${total}`;
            }
        }

        function updateStats() {
            let tytCompleted = 0, tytTotal = 0;
            for (const [key, subject] of Object.entries(tytSubjects)) {
                const topicCount = subject.topics.length + subject.topics.reduce((sum, t) => sum + (t.subtopics?.length || 0), 0);
                tytTotal += topicCount;
                tytCompleted += (userData.tyt[key] || []).length;
            }
            const tytPercentage = tytTotal > 0 ? Math.round((tytCompleted / tytTotal) * 100) : 0;
            document.getElementById('tytOverall').textContent = tytPercentage + '%';
            document.getElementById('tytProgressBar').style.width = tytPercentage + '%';
            document.getElementById('tytDetail').textContent = `${tytCompleted} / ${tytTotal} konu tamamlandƒ±`;

            let aytCompleted = 0, aytTotal = 0;
            for (const [key, subject] of Object.entries(aytSubjects)) {
                const topicCount = subject.topics.length + subject.topics.reduce((sum, t) => sum + (t.subtopics?.length || 0), 0);
                aytTotal += topicCount;
                aytCompleted += (userData.ayt[key] || []).length;
            }
            const aytPercentage = aytTotal > 0 ? Math.round((aytCompleted / aytTotal) * 100) : 0;
            document.getElementById('aytOverall').textContent = aytPercentage + '%';
            document.getElementById('aytProgressBar').style.width = aytPercentage + '%';
            document.getElementById('aytDetail').textContent = `${aytCompleted} / ${aytTotal} konu tamamlandƒ±`;

            const totalCompleted = tytCompleted + aytCompleted;
            const totalTopics = tytTotal + aytTotal;
            const totalPercentage = totalTopics > 0 ? Math.round((totalCompleted / totalTopics) * 100) : 0;
            document.getElementById('totalOverall').textContent = totalPercentage + '%';
            document.getElementById('totalProgressBar').style.width = totalPercentage + '%';
            document.getElementById('totalDetail').textContent = `${totalCompleted} / ${totalTopics} konu tamamlandƒ±`;
        }

        function renderCharts() {
            renderBarChart('tytChart', tytSubjects, 'tyt');
            renderBarChart('aytChart', aytSubjects, 'ayt');
        }

        function renderBarChart(containerId, subjects, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            const colors = [
                'linear-gradient(90deg, #f472b6, #ec4899)',
                'linear-gradient(90deg, #a78bfa, #8b5cf6)',
                'linear-gradient(90deg, #67e8f9, #06b6d4)',
                'linear-gradient(90deg, #fbbf24, #f59e0b)',
                'linear-gradient(90deg, #60a5fa, #3b82f6)',
                'linear-gradient(90deg, #34d399, #10b981)',
                'linear-gradient(90deg, #fb7185, #f43f5e)',
                'linear-gradient(90deg, #c084fc, #a855f7)',
                'linear-gradient(90deg, #f97316, #ea580c)'
            ];

            let colorIndex = 0;
            for (const [key, subject] of Object.entries(subjects)) {
                const total = subject.topics.length + subject.topics.reduce((sum, t) => sum + (t.subtopics?.length || 0), 0);
                const completed = (userData[type][key] || []).length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

                const barItem = document.createElement('div');
                barItem.className = 'bar-item';
                barItem.innerHTML = `
                    <span class="bar-label">${subject.name.substring(0, 10)}</span>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: ${percentage}%; background: ${colors[colorIndex % colors.length]}">
                            ${percentage > 10 ? percentage + '%' : ''}
                        </div>
                    </div>
                `;
                container.appendChild(barItem);
                colorIndex++;
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // Deneme Functions
        function renderDenemeForms() {
            renderDenemeForm('tytDenemeForm', tytSubjects, 'tyt');
            renderDenemeForm('aytDenemeForm', aytSubjects, 'ayt');
            tempWrongTopics = { tyt: {}, ayt: {} };
        }

        function renderDenemeForm(containerId, subjects, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            for (const [key, subject] of Object.entries(subjects)) {
                const row = document.createElement('div');
                row.className = 'form-row';
                row.innerHTML = `
                    <label>${subject.name}</label>
                    <input type="number" id="${type}_${key}_dogru" placeholder="D" min="0" max="${subject.questionCount}" onchange="calculateNet()">
                    <input type="number" id="${type}_${key}_yanlis" placeholder="Y" min="0" max="${subject.questionCount}" onchange="calculateNet()">
                    <input type="number" id="${type}_${key}_bos" placeholder="B" min="0" max="${subject.questionCount}" readonly>
                    <button class="wrong-topics-btn" onclick="openWrongTopicsModal('${type}', '${key}')" id="btn_${type}_${key}">
                        <i class="fas fa-list"></i> Konular
                    </button>
                `;
                container.appendChild(row);
            }
        }

        function switchDenemeTab(type) {
            currentDenemeType = type;
            document.querySelectorAll('.deneme-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.deneme-form').forEach(form => form.classList.remove('active'));
            event.target.classList.add('active');
            
            if (type === 'brans') {
                document.getElementById('bransDenemeForm').classList.add('active');
                selectBransCategory('matematik');
            } else {
                document.getElementById(type + 'DenemeForm').classList.add('active');
                calculateNet();
            }
        }

        function selectBransCategory(category) {
            currentBransCategory = category;
            
            document.querySelectorAll('.brans-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.brans === category);
            });
            
            const dersler = bransKategorileri[category].dersler;
            tempWrongTopics.brans = {};
            
            let formHtml = '';
            dersler.forEach(ders => {
                const dersData = tytSubjects[ders] || aytSubjects[ders];
                if (dersData) {
                    tempWrongTopics.brans[ders] = [];
                    formHtml += `
                        <div class="form-row">
                            <label>${dersData.name}</label>
                            <input type="number" id="brans_${ders}_dogru" placeholder="Doƒüru" min="0" oninput="calculateBransNet()">
                            <input type="number" id="brans_${ders}_yanlis" placeholder="Yanlƒ±≈ü" min="0" oninput="calculateBransNet()">
                            <input type="number" id="brans_${ders}_bos" placeholder="Bo≈ü" min="0">
                            <button class="wrong-topics-btn" id="btn_brans_${ders}" onclick="openBransWrongTopicsModal('${ders}')">
                                <i class="fas fa-list"></i> Konular
                            </button>
                        </div>
                    `;
                }
            });
            
            document.getElementById('bransFormContent').innerHTML = formHtml;
            calculateBransNet();
        }

        function calculateBransNet() {
            const dersler = bransKategorileri[currentBransCategory].dersler;
            let totalNet = 0;
            
            dersler.forEach(ders => {
                const dogru = parseInt(document.getElementById(`brans_${ders}_dogru`)?.value) || 0;
                const yanlis = parseInt(document.getElementById(`brans_${ders}_yanlis`)?.value) || 0;
                totalNet += dogru - (yanlis / 4);
            });
            
            document.getElementById('bransCurrentNet').textContent = totalNet.toFixed(2);
        }

        function openBransWrongTopicsModal(ders) {
            currentBransDers = ders;
            const dersData = tytSubjects[ders] || aytSubjects[ders];
            currentModalSubject = ders;
            
            const modalTopics = document.getElementById('modalTopics');
            modalTopics.innerHTML = dersData.topics.map((topic, tIndex) => {
                const hasSubtopics = topic.subtopics && topic.subtopics.length > 0;
                const isSelected = (tempWrongTopics.brans?.[currentBransDers] || []).includes(String(tIndex));
                
                let html = `
                    <div class="modal-topic-item">
                        <div class="modal-topic-header ${isSelected ? 'selected' : ''}" onclick="toggleBransModalTopic('${tIndex}', this)">
                            <span>${topic.name}</span>
                            ${hasSubtopics ? `<button class="modal-expand-btn" onclick="event.stopPropagation(); toggleBransModalSubtopics(this, ${tIndex})"><i class="fas fa-plus"></i></button>` : ''}
                        </div>
                `;
                
                if (hasSubtopics) {
                    html += `<div class="modal-subtopics" id="bransModalSub_${tIndex}">`;
                    topic.subtopics.forEach((sub, sIndex) => {
                        const subId = `${tIndex}_${sIndex}`;
                        const isSubSelected = (tempWrongTopics.brans?.[currentBransDers] || []).includes(subId);
                        html += `
                            <div class="modal-subtopic-item ${isSubSelected ? 'selected' : ''}" onclick="toggleBransModalTopic('${subId}', this)">
                                ${sub}
                            </div>
                        `;
                    });
                    html += `</div>`;
                }
                
                html += `</div>`;
                return html;
            }).join('');
            
            document.getElementById('modalOverlay').classList.add('active');
        }

        function toggleBransModalTopic(topicId, element) {
            if (!tempWrongTopics.brans) tempWrongTopics.brans = {};
            if (!tempWrongTopics.brans[currentBransDers]) tempWrongTopics.brans[currentBransDers] = [];
            
            const index = tempWrongTopics.brans[currentBransDers].indexOf(topicId);
            if (index > -1) {
                tempWrongTopics.brans[currentBransDers].splice(index, 1);
                element.classList.remove('selected');
            } else {
                tempWrongTopics.brans[currentBransDers].push(topicId);
                element.classList.add('selected');
            }
        }

        function toggleBransModalSubtopics(btn, tIndex) {
            const container = document.getElementById(`bransModalSub_${tIndex}`);
            const icon = btn.querySelector('i');
            container.classList.toggle('open');
            icon.className = container.classList.contains('open') ? 'fas fa-minus' : 'fas fa-plus';
        }

        function calculateNet() {
            const subjects = currentDenemeType === 'tyt' ? tytSubjects : aytSubjects;
            let totalNet = 0;

            for (const [key, subject] of Object.entries(subjects)) {
                const dogru = parseInt(document.getElementById(`${currentDenemeType}_${key}_dogru`)?.value) || 0;
                const yanlis = parseInt(document.getElementById(`${currentDenemeType}_${key}_yanlis`)?.value) || 0;
                const bos = subject.questionCount - dogru - yanlis;
                
                const bosInput = document.getElementById(`${currentDenemeType}_${key}_bos`);
                if (bosInput) bosInput.value = bos >= 0 ? bos : 0;

                totalNet += dogru - (yanlis / 4);
            }
            document.getElementById('currentNet').textContent = totalNet.toFixed(2);
        }

        function openWrongTopicsModal(type, subjectKey) {
            currentModalSubject = { type, subjectKey };
            const subjects = type === 'tyt' ? tytSubjects : aytSubjects;
            const subject = subjects[subjectKey];
            const modalTopics = document.getElementById('modalTopics');
            modalTopics.innerHTML = '';

            const selectedTopics = tempWrongTopics[type][subjectKey] || [];

            subject.topics.forEach((topic, tIndex) => {
                const topicId = `${tIndex}`;
                const isSelected = selectedTopics.includes(topicId);
                const hasSubtopics = topic.subtopics && topic.subtopics.length > 0;

                const topicDiv = document.createElement('div');
                topicDiv.innerHTML = `
                    <div class="modal-topic-item ${isSelected ? 'selected' : ''}" data-topic-id="${topicId}">
                        ${hasSubtopics ? `<button class="modal-expand-btn" onclick="event.stopPropagation(); toggleModalSubtopics(this, ${tIndex})"><i class="fas fa-plus"></i></button>` : ''}
                        <div class="checkbox" onclick="toggleModalTopic(this.parentElement, '${topicId}')">${isSelected ? '<i class="fas fa-check"></i>' : ''}</div>
                        <span class="modal-topic-name" onclick="toggleModalTopic(this.parentElement, '${topicId}')">${topic.name}</span>
                    </div>
                    <div class="modal-subtopics" id="modal_subtopics_${tIndex}">
                        ${(topic.subtopics || []).map((sub, sIndex) => {
                            const subId = `${tIndex}_${sIndex}`;
                            const isSubSelected = selectedTopics.includes(subId);
                            return `
                                <div class="modal-subtopic-item ${isSubSelected ? 'selected' : ''}" data-topic-id="${subId}" onclick="toggleModalTopic(this, '${subId}')">
                                    <div class="checkbox">${isSubSelected ? '<i class="fas fa-check"></i>' : ''}</div>
                                    <span>${sub}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                modalTopics.appendChild(topicDiv);
            });

            document.getElementById('modalOverlay').classList.add('active');
        }

        function toggleModalSubtopics(btn, tIndex) {
            const container = document.getElementById(`modal_subtopics_${tIndex}`);
            const icon = btn.querySelector('i');
            container.classList.toggle('open');
            icon.className = container.classList.contains('open') ? 'fas fa-minus' : 'fas fa-plus';
        }

        function toggleModalTopic(element, topicId) {
            element.classList.toggle('selected');
            const checkbox = element.querySelector('.checkbox');
            checkbox.innerHTML = element.classList.contains('selected') ? '<i class="fas fa-check"></i>' : '';
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        function saveWrongTopics() {
            // Check if this is a bran≈ü modal
            if (currentDenemeType === 'brans' && typeof currentModalSubject === 'string') {
                // Bran≈ü modal - data is already saved via toggleBransModalTopic
                const count = (tempWrongTopics.brans?.[currentModalSubject] || []).length;
                const btn = document.getElementById(`btn_brans_${currentModalSubject}`);
                if (btn) {
                    if (count > 0) {
                        btn.classList.add('has-selection');
                        btn.innerHTML = `<i class="fas fa-check"></i> ${count} konu`;
                    } else {
                        btn.classList.remove('has-selection');
                        btn.innerHTML = `<i class="fas fa-list"></i> Konular`;
                    }
                }
                closeModal();
                return;
            }
            
            const { type, subjectKey } = currentModalSubject;
            const selectedItems = document.querySelectorAll('#modalTopics .modal-topic-item.selected, #modalTopics .modal-subtopic-item.selected');
            
            tempWrongTopics[type][subjectKey] = [];
            selectedItems.forEach(item => {
                tempWrongTopics[type][subjectKey].push(item.dataset.topicId);
            });

            const btn = document.getElementById(`btn_${type}_${subjectKey}`);
            if (tempWrongTopics[type][subjectKey].length > 0) {
                btn.classList.add('has-selection');
                btn.innerHTML = `<i class="fas fa-check"></i> ${tempWrongTopics[type][subjectKey].length} konu`;
            } else {
                btn.classList.remove('has-selection');
                btn.innerHTML = `<i class="fas fa-list"></i> Konular`;
            }
            closeModal();
        }

        function saveDeneme() {
            const date = document.getElementById('denemeDate').value;
            if (!date) { alert('L√ºtfen tarih se√ßin!'); return; }

            // Bran≈ü denemesi kaydƒ±
            if (currentDenemeType === 'brans') {
                saveBransDeneme(date);
                return;
            }

            const subjects = currentDenemeType === 'tyt' ? tytSubjects : aytSubjects;
            
            // If editing, remove old wrong topics first
            if (editingDenemeId) {
                const oldDeneme = userData.denemeler.find(d => d.id === editingDenemeId);
                if (oldDeneme && oldDeneme.wrongTopics) {
                    for (const [subKey, topics] of Object.entries(oldDeneme.wrongTopics)) {
                        if (userData.wrongTopics[oldDeneme.type]?.[subKey]) {
                            topics.forEach(topicId => {
                                if (userData.wrongTopics[oldDeneme.type][subKey][topicId]) {
                                    userData.wrongTopics[oldDeneme.type][subKey][topicId]--;
                                    if (userData.wrongTopics[oldDeneme.type][subKey][topicId] <= 0) {
                                        delete userData.wrongTopics[oldDeneme.type][subKey][topicId];
                                    }
                                }
                            });
                        }
                    }
                }
            }

            const denemeData = {
                id: editingDenemeId || Date.now(),
                type: currentDenemeType,
                date: date,
                subjects: {},
                wrongTopics: JSON.parse(JSON.stringify(tempWrongTopics[currentDenemeType])),
                totalNet: parseFloat(document.getElementById('currentNet').textContent)
            };

            for (const [key, subject] of Object.entries(subjects)) {
                const dogru = parseInt(document.getElementById(`${currentDenemeType}_${key}_dogru`)?.value) || 0;
                const yanlis = parseInt(document.getElementById(`${currentDenemeType}_${key}_yanlis`)?.value) || 0;
                denemeData.subjects[key] = { dogru, yanlis };

                // Add new wrong topics
                if (tempWrongTopics[currentDenemeType][key]) {
                    if (!userData.wrongTopics[currentDenemeType][key]) {
                        userData.wrongTopics[currentDenemeType][key] = {};
                    }
                    tempWrongTopics[currentDenemeType][key].forEach(topicId => {
                        userData.wrongTopics[currentDenemeType][key][topicId] = 
                            (userData.wrongTopics[currentDenemeType][key][topicId] || 0) + 1;
                    });
                }
            }

            if (editingDenemeId) {
                const index = userData.denemeler.findIndex(d => d.id === editingDenemeId);
                if (index > -1) userData.denemeler[index] = denemeData;
            } else {
                userData.denemeler.push(denemeData);
            }

            saveUserData();
            cancelEdit();
            renderDenemeForms();
            renderEksikKonular();
            renderDenemeHistory();
            renderSubjects();
            alert(editingDenemeId ? 'Deneme g√ºncellendi! ‚ú®' : 'Deneme kaydedildi! üéâ');
        }

        function editDeneme(id) {
            const deneme = userData.denemeler.find(d => d.id === id);
            if (!deneme) return;

            editingDenemeId = id;
            currentDenemeType = deneme.type;

            // Switch to correct tab
            document.querySelectorAll('.deneme-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.deneme-form').forEach(form => form.classList.remove('active'));
            document.querySelector(`.deneme-tab-btn:${deneme.type === 'tyt' ? 'first-child' : 'last-child'}`).classList.add('active');
            document.getElementById(deneme.type + 'DenemeForm').classList.add('active');

            // Fill form
            document.getElementById('denemeDate').value = deneme.date;
            
            const subjects = deneme.type === 'tyt' ? tytSubjects : aytSubjects;
            for (const [key] of Object.entries(subjects)) {
                const data = deneme.subjects[key] || { dogru: 0, yanlis: 0 };
                document.getElementById(`${deneme.type}_${key}_dogru`).value = data.dogru || '';
                document.getElementById(`${deneme.type}_${key}_yanlis`).value = data.yanlis || '';
            }

            // Load wrong topics
            tempWrongTopics[deneme.type] = JSON.parse(JSON.stringify(deneme.wrongTopics || {}));
            
            // Update buttons
            for (const [key] of Object.entries(subjects)) {
                const btn = document.getElementById(`btn_${deneme.type}_${key}`);
                const count = (tempWrongTopics[deneme.type][key] || []).length;
                if (count > 0) {
                    btn.classList.add('has-selection');
                    btn.innerHTML = `<i class="fas fa-check"></i> ${count} konu`;
                }
            }

            calculateNet();

            // Update UI
            document.getElementById('denemeFormTitle').innerHTML = '<i class="fas fa-edit" style="color: var(--warning-dark);"></i> Deneme D√ºzenle';
            document.getElementById('saveDenemeBtn').innerHTML = '<i class="fas fa-save"></i> G√ºncelle';
            document.getElementById('cancelEditBtn').style.display = 'block';

            // Scroll to form
            document.querySelector('.deneme-form-card').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            editingDenemeId = null;
            document.getElementById('denemeFormTitle').innerHTML = '<i class="fas fa-plus-circle" style="color: var(--primary);"></i> Yeni Deneme Ekle';
            document.getElementById('saveDenemeBtn').innerHTML = '<i class="fas fa-save"></i> Denemeyi Kaydet';
            document.getElementById('cancelEditBtn').style.display = 'none';
            
            // Clear form
            const subjects = currentDenemeType === 'tyt' ? tytSubjects : aytSubjects;
            for (const [key] of Object.entries(subjects)) {
                document.getElementById(`${currentDenemeType}_${key}_dogru`).value = '';
                document.getElementById(`${currentDenemeType}_${key}_yanlis`).value = '';
                document.getElementById(`${currentDenemeType}_${key}_bos`).value = '';
                const btn = document.getElementById(`btn_${currentDenemeType}_${key}`);
                btn.classList.remove('has-selection');
                btn.innerHTML = `<i class="fas fa-list"></i> Konular`;
            }
            tempWrongTopics = { tyt: {}, ayt: {} };
            document.getElementById('currentNet').textContent = '0.00';
            document.getElementById('denemeDate').valueAsDate = new Date();
        }

        function renderEksikKonular() {
            const eksikList = document.getElementById('eksikList');
            const allWrong = [];

            ['tyt', 'ayt'].forEach(type => {
                const subjects = type === 'tyt' ? tytSubjects : aytSubjects;
                for (const [subjectKey, wrongTopics] of Object.entries(userData.wrongTopics[type] || {})) {
                    for (const [topicId, count] of Object.entries(wrongTopics)) {
                        if (count > 0) {
                            const parts = topicId.split('_');
                            const tIndex = parseInt(parts[0]);
                            let topicName = subjects[subjectKey]?.topics[tIndex]?.name || 'Bilinmeyen';
                            if (parts.length > 1) {
                                const sIndex = parseInt(parts[1]);
                                topicName = subjects[subjectKey]?.topics[tIndex]?.subtopics?.[sIndex] || topicName;
                            }
                            allWrong.push({
                                type, subjectKey, topicId,
                                subjectName: subjects[subjectKey]?.name || 'Bilinmeyen',
                                topicName, count
                            });
                        }
                    }
                }
            });

            allWrong.sort((a, b) => b.count - a.count);

            if (allWrong.length === 0) {
                eksikList.innerHTML = `
                    <div class="no-eksik">
                        <i class="fas fa-check-circle"></i>
                        <p>Hen√ºz yanlƒ±≈ü yapƒ±lan konu yok!</p>
                        <p style="font-size: 0.9rem;">Deneme ekleyerek eksiklerini takip edebilirsin.</p>
                    </div>
                `;
                return;
            }

            eksikList.innerHTML = allWrong.slice(0, 15).map(item => `
                <div class="eksik-item">
                    <div class="topic-info">
                        <div class="topic-name">${item.topicName}</div>
                        <div class="subject-name">${item.type.toUpperCase()} - ${item.subjectName}</div>
                    </div>
                    <div class="eksik-actions">
                        <button class="tekrar-btn" onclick="clearWrongTopic('${item.type}', '${item.subjectKey}', '${item.topicId}')">
                            <i class="fas fa-check"></i> Tekrar Ettim
                        </button>
                        <div class="wrong-badge">${item.count} yanlƒ±≈ü</div>
                    </div>
                </div>
            `).join('');
        }

        function clearWrongTopic(type, subjectKey, topicId) {
            if (!confirm('Bu konuyu tekrar ettiƒüini onaylƒ±yor musun? Yanlƒ±≈ü sayƒ±sƒ± sƒ±fƒ±rlanacak.')) return;
            
            if (userData.wrongTopics[type]?.[subjectKey]?.[topicId]) {
                delete userData.wrongTopics[type][subjectKey][topicId];
                
                // Clean up empty objects
                if (Object.keys(userData.wrongTopics[type][subjectKey]).length === 0) {
                    delete userData.wrongTopics[type][subjectKey];
                }
                
                saveUserData();
                renderEksikKonular();
                renderSubjects();
            }
        }

        function renderDenemeHistory() {
            const historyContainer = document.getElementById('denemeHistory');
            const denemeler = userData.denemeler || [];
            const bransDenemeler = userData.bransDenemeler || [];
            
            // Combine and sort all denemeler
            const allDenemeler = [
                ...denemeler.map(d => ({ ...d, isBrans: false })),
                ...bransDenemeler.map(d => ({ ...d, isBrans: true }))
            ];

            if (allDenemeler.length === 0) {
                historyContainer.innerHTML = `
                    <div class="no-eksik" style="grid-column: 1 / -1;">
                        <i class="fas fa-clipboard-list" style="color: var(--primary);"></i>
                        <p>Hen√ºz deneme eklenmemi≈ü!</p>
                    </div>
                `;
                return;
            }

            const sortedDenemeler = allDenemeler.sort((a, b) => new Date(b.date) - new Date(a.date));

            historyContainer.innerHTML = sortedDenemeler.map(deneme => {
                if (deneme.isBrans) {
                    // Bran≈ü denemesi kartƒ±
                    const categoryIcon = {
                        matematik: 'fa-calculator',
                        geometri: 'fa-shapes',
                        turkce: 'fa-pen-fancy',
                        fen: 'fa-flask',
                        sosyal: 'fa-landmark'
                    }[deneme.category] || 'fa-book';
                    
                    // Generate subjects HTML from dersler
                    const derslerHtml = Object.entries(deneme.dersler || {}).map(([ders, data]) => {
                        const dersData = tytSubjects[ders] || aytSubjects[ders];
                        return `<span class="history-subject">${dersData?.name?.substring(0, 3) || ders}: <span class="d">${data.dogru}D</span> <span class="y">${data.yanlis}Y</span></span>`;
                    }).join('');
                    
                    return `
                        <div class="history-card">
                            <span class="type-badge brans" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">BRAN≈û</span>
                            <div class="date"><i class="fas fa-calendar"></i> ${new Date(deneme.date).toLocaleDateString('tr-TR')}</div>
                            <div style="display: flex; align-items: center; gap: 8px; margin: 10px 0;">
                                <i class="fas ${categoryIcon}" style="color: var(--primary);"></i>
                                <strong>${deneme.categoryName || bransKategorileri[deneme.category]?.name || deneme.category}</strong>
                            </div>
                            <div class="net-info">${(deneme.totalNet || 0).toFixed(2)} Net</div>
                            <div class="history-subjects">${derslerHtml}</div>
                            <div class="history-actions">
                                <button class="delete-history-btn" onclick="deleteBransDeneme(${deneme.id})">
                                    <i class="fas fa-trash"></i> Sil
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    // Normal TYT/AYT denemesi kartƒ±
                    const subjects = deneme.type === 'tyt' ? tytSubjects : aytSubjects;
                    const subjectsHtml = Object.entries(deneme.subjects || {}).map(([key, data]) => 
                        `<span class="history-subject">${subjects[key]?.name?.substring(0, 3) || key}: <span class="d">${data.dogru}D</span> <span class="y">${data.yanlis}Y</span></span>`
                    ).join('');

                    return `
                        <div class="history-card">
                            <span class="type-badge ${deneme.type}">${deneme.type.toUpperCase()}</span>
                            <div class="date"><i class="fas fa-calendar"></i> ${new Date(deneme.date).toLocaleDateString('tr-TR')}</div>
                            <div class="net-info">${(deneme.totalNet || 0).toFixed(2)} Net</div>
                            <div class="history-subjects">${subjectsHtml}</div>
                            <div class="history-actions">
                                <button class="edit-history-btn" onclick="editDeneme(${deneme.id})">
                                    <i class="fas fa-edit"></i> D√ºzenle
                                </button>
                                <button class="delete-history-btn" onclick="deleteDeneme(${deneme.id})">
                                    <i class="fas fa-trash"></i> Sil
                                </button>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        function saveBransDeneme(date) {
            const dersler = bransKategorileri[currentBransCategory].dersler;
            let hasData = false;
            let totalNet = 0;
            const derslerData = {};
            
            // Collect data from all subjects
            dersler.forEach(ders => {
                const dogru = parseInt(document.getElementById(`brans_${ders}_dogru`)?.value) || 0;
                const yanlis = parseInt(document.getElementById(`brans_${ders}_yanlis`)?.value) || 0;
                if (dogru > 0 || yanlis > 0) {
                    hasData = true;
                    const net = dogru - (yanlis / 4);
                    totalNet += net;
                    derslerData[ders] = { dogru, yanlis, net, wrongTopics: tempWrongTopics.brans?.[ders] || [] };
                }
            });
            
            if (!hasData) { alert('L√ºtfen en az bir ders i√ßin doƒüru veya yanlƒ±≈ü sayƒ±sƒ± girin!'); return; }
            
            // Initialize bransDenemeler if not exists
            if (!userData.bransDenemeler) userData.bransDenemeler = [];
            
            const bransData = {
                id: Date.now(),
                type: 'brans',
                category: currentBransCategory,
                categoryName: bransKategorileri[currentBransCategory].name,
                date: date,
                dersler: derslerData,
                totalNet: totalNet
            };
            
            // Add wrong topics to global count
            for (const [ders, data] of Object.entries(derslerData)) {
                const targetType = tytSubjects[ders] ? 'tyt' : 'ayt';
                if (data.wrongTopics && data.wrongTopics.length > 0) {
                    if (!userData.wrongTopics[targetType][ders]) {
                        userData.wrongTopics[targetType][ders] = {};
                    }
                    data.wrongTopics.forEach(topicId => {
                        userData.wrongTopics[targetType][ders][topicId] = 
                            (userData.wrongTopics[targetType][ders][topicId] || 0) + 1;
                    });
                }
            }
            
            userData.bransDenemeler.push(bransData);
            saveUserData();
            
            // Reset form
            dersler.forEach(ders => {
                const dogruInput = document.getElementById(`brans_${ders}_dogru`);
                const yanlisInput = document.getElementById(`brans_${ders}_yanlis`);
                const bosInput = document.getElementById(`brans_${ders}_bos`);
                const btn = document.getElementById(`btn_brans_${ders}`);
                if (dogruInput) dogruInput.value = '';
                if (yanlisInput) yanlisInput.value = '';
                if (bosInput) bosInput.value = '';
                if (btn) {
                    btn.classList.remove('has-selection');
                    btn.innerHTML = '<i class="fas fa-list"></i> Konular';
                }
            });
            document.getElementById('bransCurrentNet').textContent = '0.00';
            tempWrongTopics.brans = {};
            
            renderDenemeHistory();
            renderEksikKonular();
            renderSubjects();
            alert('Bran≈ü denemesi kaydedildi! üéâ');
        }

        function deleteBransDeneme(id) {
            if (!confirm('Bu bran≈ü denemesini silmek istediƒüinize emin misiniz?')) return;
            
            const index = userData.bransDenemeler.findIndex(d => d.id === id);
            if (index > -1) {
                const deneme = userData.bransDenemeler[index];
                
                // Remove wrong topics from all subjects in this deneme
                if (deneme.dersler) {
                    for (const [ders, data] of Object.entries(deneme.dersler)) {
                        const targetType = tytSubjects[ders] ? 'tyt' : 'ayt';
                        if (data.wrongTopics && data.wrongTopics.length > 0) {
                            data.wrongTopics.forEach(topicId => {
                                if (userData.wrongTopics[targetType]?.[ders]?.[topicId]) {
                                    userData.wrongTopics[targetType][ders][topicId]--;
                                    if (userData.wrongTopics[targetType][ders][topicId] <= 0) {
                                        delete userData.wrongTopics[targetType][ders][topicId];
                                    }
                                }
                            });
                        }
                    }
                }
                
                userData.bransDenemeler.splice(index, 1);
                saveUserData();
                renderDenemeHistory();
                renderEksikKonular();
                renderSubjects();
            }
        }

        function deleteDeneme(id) {
            if (!confirm('Bu denemeyi silmek istediƒüinize emin misiniz?')) return;

            const index = userData.denemeler.findIndex(d => d.id === id);
            if (index > -1) {
                const deneme = userData.denemeler[index];
                
                if (deneme.wrongTopics) {
                    for (const [subjectKey, topics] of Object.entries(deneme.wrongTopics)) {
                        if (userData.wrongTopics[deneme.type]?.[subjectKey]) {
                            topics.forEach(topicId => {
                                if (userData.wrongTopics[deneme.type][subjectKey][topicId]) {
                                    userData.wrongTopics[deneme.type][subjectKey][topicId]--;
                                    if (userData.wrongTopics[deneme.type][subjectKey][topicId] <= 0) {
                                        delete userData.wrongTopics[deneme.type][subjectKey][topicId];
                                    }
                                }
                            });
                        }
                    }
                }

                userData.denemeler.splice(index, 1);
                saveUserData();
                renderDenemeHistory();
                renderEksikKonular();
                renderSubjects();
            }
        }

        window.onload = function() {
            const lastUser = localStorage.getItem('yks_lastUser');
            if (lastUser) document.getElementById('usernameInput').value = lastUser;
        };
    </script>
</body>
</html>

